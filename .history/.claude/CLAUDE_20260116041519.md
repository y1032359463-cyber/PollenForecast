# 花粉浓度播报 (PollenForecast)

> **作用范围**: 本项目专属文档
> **最后更新**: 2026-01-16 (智能搜索功能完成：拼音搜索支持全中国区域)
> **AI 维护者**: Qoder / Claude

---

## ⚠️ AI 必读规则

**文档整理提醒**：读取本文档时，如果发现行数 > 600行，询问用户："检测到 CLAUDE.md 已达到 [行数] 行，建议整理。是否现在整理？"

### 🚨 文档整理硬规则（必须遵守）

**⚠️ 核心原则**：**先转移，确认成功后再删除**

整理流程：
1. **第一步：转移内容**
   - 详细开发历史 → 转移到 `开发日志.md`
   - 通用技术方案 → 转移到 `知识库/分类文件.md`
   - 已解决问题 → 转移到 `问题记录.md`

2. **第二步：确认转移成功**
   - 检查目标文件是否存在且内容完整
   - 验证转移的内容行数是否匹配
   - 确认链接和引用正确

3. **第三步：删除原内容**
   - **只有确认转移成功后，才能删除原文件中的对应内容**
   - 删除时保留指向新文件的链接

**❌ 禁止操作**：
- ❌ 禁止未转移就删除
- ❌ 禁止转移未确认就删除
- ❌ 禁止一次性删除大量内容而不验证

---

## 🚨 当前状态概要（新窗口必读）

### ⚠️ 当前状态（2026-01-16 更新）

**智能搜索功能完成** - 实现了完整的拼音搜索功能，支持全中国3244个区域（省/直辖市34个、地级市369个、区县2841个）的拼音首字母搜索，支持 `bj`/`js`/`gz` 等快捷输入 ✨

**地图深浅色模式修复** - 使用 Map Kit 内置 `dayNightMode` API 实现了地图自动跟随系统主题切换，适配了 API 20+ 的 `mapCommon.DayNightMode` 枚举类型 ✅

**预审对比度问题修复** - 调整了花粉等级文字颜色系统 (`levelToTextColor`)，确保文字/背景对比度 ≥ 4.5:1，图标对比度 ≥ 3:1，修复了 RegionView 结构错误及 Map API 类型匹配问题，通过华为应用市场预审合规要求 ✅

**数据可视化深度优化规划 (P0-P2)** - 制定了分阶段实施计划，包含和风花粉接入、贝塞尔曲线图表重构、26天数据保留等方案 📋

**RegionView 收藏功能深度重构** - 修复了收藏失效、星标展示不统一等问题；新增双 Tab 切换，增加了震动反馈 ✅

**版本升级至 v1.1.0** - 随功能提升，versionName 升级为 1.1.0，versionCode 增加至 1000005 ✅

**三级菜单功能完全修复** - 直辖市特殊数据结构处理已完成，所有城市均可正常弹出区县选择菜单 ✅

**敏舒服务器代理深度优化** - 修复了 URL 格式，实现了 7 天数据保留及自动抓取任务 ✅

**项目备份规则已建立** - 建立了完整的备份机制和操作指南

**构建配置已恢复** - 从备份恢复了完整的 `build-profile.json5` 配置

### ⏳ 待完善功能 (可视化优化计划)
|- [ ] **P0: 数据源增强** - 接入和风天气花粉数据，实现双源聚合 ( Indices API )
|- [x] **P0: 智能搜索** - ✅ 已完成（2026-01-16，Claude）
  - ✅ 生成全中国3244个区域的拼音映射表
  - ✅ 支持拼音首字母前缀匹配（如 `js` 可匹配 `金山区`）
  - ✅ 支持中文名称、完整拼音、首字母缩写等多种搜索方式
  - ✅ 集成到 `CityUtils.ets` 和 `RegionView.ets`
|- [ ] **P1: 图表视觉重构** - 引入贝塞尔曲线 (Bezier Curve) 与渐变面积填充
|- [ ] **P1: 数据周期扩展** - 服务器数据保留延长至 26 天，实现真实"月度趋势"
|- [ ] **P1: 商业化基础** - 搭建会员/Pro 框架，预留解锁无限收藏入口
|- [ ] **P2: 动态年度趋势** - 实现"历史实测 + 气候基准"混合展示方案
|- [x] API 17 真机验证 - ✅ 已通过（用户确认）
|- [x] 导航栏毛玻璃效果修复 - ✅ 已替换成其他方案（用户确认）
|- [ ] 经纬度转 adcode 功能（服务器端逆地理编码接口）
|- [x] 扩展数据模型支持 `todayAllergy` 字段（过敏等级和建议） - ✅ 敏舒 API 已支持

### 📋 区域Tab优化计划
|- [ ] 实现花粉浓度排序：按当前城市花粉浓度从低到高排序
|- [x] 城市分类改进：按照省份或地区分组显示城市列表（已实现省份分组折叠，2026-01-11）
|- [x] **三级城市选择功能**（新增，2026-01-11，2026-01-13 完全修复）✨
  - ✅ UTF-8编码问题已修复
  - ✅ 深色模式弹窗背景色已适配
  - ✅ **直辖市特殊处理**（北京、上海、天津、重庆）
  - ✅ 数据来源: 使用本地JSON数据
|- [x] **收藏功能深度修复与 UI 重构** (2026-01-15) ✨
  - ✅ 引入 `favoriteCities` 统一数据源
  - ✅ 修复 `toggleFavorite` 模糊匹配名称逻辑
  - ✅ 实现"热门城市 / 我的收藏"双 Tab 切换
  - ✅ 增加收藏上限（4个）与友好 Toast 提示
  - ✅ 修复滑动收藏按钮单一展开逻辑
  - ✅ 增加 30ms 触感反馈（震动）
|- [x] 智能搜索增强：增加拼音搜索功能 (P0) - ✅ 已完成（2026-01-16）
|- [ ] 城市详情页：点击城市后可查看该城市的详细花粉信息 (P2)
|- [ ] 搜索历史：记录用户搜索过的城市，方便快速访问
|- [ ] 性能优化：使用虚拟滚动提升大量城市数据的性能

> **详细开发历史**：见 [开发日志.md](./开发日志.md)

### 📂 关键文件位置
|| 文件 | 用途 |
||------|------|
|| `entry/src/main/ets/utils/ReminderService.ets` | 代理提醒服务（2026-01-07 新增）✨ |
|| `entry/src/main/ets/utils/NotificationService.ets` | 通知服务（调用 ReminderService）|
|| `entry/src/main/ets/utils/ApiVersionUtils.ets` | API 版本检测 |
|| `entry/src/main/ets/utils/AdcodeUtils.ets` | 城市编码工具类（2026-01-09 新增）✨ |
|| `entry/src/main/ets/utils/ChinaAreaDataLoader.ets` | 城市区县数据加载器（2026-01-13 修复）✨ |
|| `entry/src/main/ets/service/MinshuDataSourceAdapter.ets` | 敏舒数据源适配器（2026-01-09 新增）✨ |
|| `C:\HarmonyOS_App_Plans\.claude\知识库.md` | 已验证的技术方案 |
|| `C:\HarmonyOS_App_Plans\.claude\备份规则.md` | 项目备份规则和操作指南（2026-01-10 新增）✨ |

---

## 📁 文件夹说明

### 项目级 `.claude/` (本文件夹)
|| 文件 | 用途 |
||------|------|
|| `CLAUDE.md` | 项目指导文档，AI 阅读理解项目 |
|| `开发日志.md` | 详细开发历史记录 |
|| `问题记录.md` | 构建修复和问题解决记录 |

### 全局级 `C:\HarmonyOS_App_Plans\.claude/` (共享)
|| 文件 | 用途 | 操作规则 |
||------|------|----------|
|| `当前问题.md` | 与 CodeGenie 实时沟通 | **可清空重写** |
|| `知识库.md` | 已验证的解决方案和技术要点 | **只追加，不删除** |

> 💡 **跨项目复用**: 知识库.md 放在上级文件夹，所有鸿蒙项目共享

---

## 🎯 项目概述

**花粉浓度播报** - 基于鸿蒙生态的智能花粉过敏管理平台

|| 属性 | 值 |
||------|-----|
|| **应用ID** | com.eric.PollenForecast |
|| **中文名** | 花粉浓度播报 |
|| **SDK版本** | API 20 (6.0.0) |
|| **版本** | 1.1.0 (1000005) |
|| **状态** | 🚀 智能搜索完成，准备上架 |
|| **优先级** | P0 - 核心开发项目 |
|| **构建** | ✅ 成功 (2026-01-15 验证) |

### 目标用户
- 花粉过敏患者（中国约2亿人群）
- 有户外活动需求的健康意识人群
- 需要照顾过敏家庭成员的用户

### 核心差异化
- 🌍 **精准数据**: Google Pollen API + 和风天气 双数据源
- 📱 **鸿蒙生态**: 分布式数据同步、原子化服务卡片
- 🤖 **智能预警**: 个性化风险评估、多设备联动提醒
- ⌚ **设备协同**: 手机、手表、平板数据实时同步

---

## 📂 项目结构

```
PollenForecast/
├── .claude/                    # AI 协作文档（知识管理中心）
│   ├── CLAUDE.md              # 本文件 - 项目指导文档
│   └── 开发日志.md             # 详细开发历史记录
├── AppScope/                   # 应用全局配置
│   └── resources/
│       └── base/element/
│           └── string.json    # 应用名称: 花粉浓度播报
├── entry/                      # 主模块
│   └── src/main/
│       ├── ets/
│       │   ├── entryability/  # 入口Ability
│       │   ├── entryformability/  # Widget Ability
│       │   │   └── EntryFormAbility.ets
│       │   ├── pages/         # 页面
│       │   │   ├── Index.ets  # 主页面(TabBar容器)
│       │   │   └── GeneralSettingsPage.ets  # 通用设置页
│       │   ├── views/         # 视图组件
│       │   │   ├── PollenIndexView.ets  # Tab1: 花粉指数首页
│       │   │   ├── RegionView.ets       # Tab2: 区域选择
│       │   │   ├── MapView.ets          # Tab3: 花粉地图
│       │   │   └── SettingsView.ets     # Tab4: 设置
│       │   ├── widget/        # 桌面卡片
│       │   │   └── PollenCard.ets       # 2x2 花粉卡片
│       │   ├── viewmodel/     # 视图模型
│       │   │   └── HomeViewModel.ets
│       │   ├── model/         # 数据模型
│       │   │   └── PollenModels.ets    # 花粉数据模型
│       │   ├── service/       # 服务层
│       │   │   └── PollenService.ets   # Google Pollen API服务
│       │   └── utils/         # 工具类
│       ├── resources/         # 资源文件
│       │   ├── base/rawfile/  # 原始数据文件
│       │   │   ├── china_area_full.json  # 中国行政区划数据
│       │   │   └── pinyin_map.json      # 拼音映射表（2026-01-16新增）✨
│       │   └── base/profile/
│       │       └── form_config.json    # Widget配置
│       └── module.json5       # 模块配置（含网络权限）
├── scripts/                    # 脚本工具
│   ├── generate_pinyin_map.js # 拼音映射表生成脚本（2026-01-16新增）✨
│   ├── generate_cities_json.js # 城市JSON生成
│   └── package.json           # 脚本依赖配置
├── oh-package.json5           # 依赖配置
└── build-profile.json5        # 构建配置
```

---

## 🎨 功能模块规划

### MVP 阶段（第一版）

|| 模块 | 功能 | 状态 |
||------|------|------|
|| **首页** | 当前位置花粉浓度显示、风险等级 | ✅ 已完成 |
|| **7天预报** | 未来一周花粉浓度趋势 | ✅ 已完成 |
|| **防护指南** | 根据风险等级的防护建议 | ✅ 已完成 |
|| **位置服务** | GPS定位获取当前位置 | ✅ 已完成 |
|| **城市管理** | 关注城市列表、置顶、删除 | ✅ 已完成 |
|| **主题适配** | 浅色/深色主题切换 | ✅ 已完成 |

### 进阶功能（后续版本）

|| 模块 | 功能 | 状态 |
||------|------|------|
|| **服务卡片** | 桌面花粉浓度卡片 2×2 | ✅ 已完成 |
|| **过敏档案** | 用户过敏类型、程度记录 | ✅ 已完成 (自测问卷) |
|| **智能提醒** | 基于用户画像的预警推送 | 📋 规划中 |
|| **分布式同步** | 跨设备数据同步 | 📋 规划中 |
|| **健康数据** | 结合手表心率、睡眠分析 | 📋 规划中 |

---

## 🔧 技术栈

### 开发环境
```
DevEco Studio: 6.0.x
HarmonyOS SDK: 6.0.0 (API 20)
语言: ArkTS
框架: ArkUI (声明式UI)
模型: Stage模型
```

### 关键依赖
- `@ohos.net.http` - 网络请求
- `@ohos.geoLocationManager` - 位置服务
- `@ohos.data.preferences` - 本地存储
- `@ohos.distributedKVStore` - 分布式数据（后续）

### 数据来源（规划）
1. **中国气象局API** - 国内权威花粉数据
2. **Google Pollen API** - 全球花粉覆盖（需API Key）
3. **和风天气** - 备选数据源

---

## 📈 开发进度

### 当前阶段: AppGallery审核准备

#### 已完成 ✅
|- [x] **智能搜索功能完成** (2026-01-16) ✨ P0
  - ✅ 生成全中国3244个区域的拼音映射表（省/直辖市34个、地级市369个、区县2841个） **(GLM-4.7)**
  - ✅ 支持拼音首字母前缀匹配（如 `js` 可匹配 `金山区`） **(GLM-4.7)**
  - ✅ 支持中文名称、完整拼音、首字母缩写等多种搜索方式 **(GLM-4.7)**
  - ✅ 集成到 `CityUtils.ets` 和 `RegionView.ets` **(GLM-4.7)**
  - ✅ 生成文件：
    - `scripts/generate_pinyin_map.js` - 拼音映射表生成脚本 **(GLM-4.7)**
    - `entry/src/main/resources/rawfile/pinyin_map.json` - 拼音映射表数据 **(GLM-4.7)**
    - `entry/src/main/ets/utils/CityUtils.ets` - 更新搜索函数 **(GLM-4.7)**
  - **开发者**: GLM-4.7
|- [x] **地图深浅色模式修复** (2026-01-15) ✨
  - ✅ 接入 Map Kit 内置 `dayNightMode` 属性（API 20+）
  - ✅ 实现 `onThemeChanged` 监听自动调用 `setDayNightMode`
  - ✅ 适配 `mapCommon.DayNightMode` 枚举类型（NIGHT/DAY）
|- [x] **预审对比度问题修复** (2026-01-15) ✨ 紧急
  - ✅ 引入 `levelToTextColor` 确保浅色模式下低对比度文字（如黄色/浅绿）对比度 ≥ 4.5:1
  - ✅ 修复 2x2 服务卡片 (Widget) 文字对比度合规问题
  - ✅ 修复 `RegionView.ets` 结构嵌套错误及 `MapView.ets` 类型匹配错误
  - ✅ 优化数据来源感谢文案对比度，移除不合规的透明度设置
|- [x] DevEco Studio 创建项目
|- [x] 设置中文应用名称 "花粉浓度播报"
|- [x] 创建项目 CLAUDE.md 文档
|- [x] 4个Tab页面基础UI（首页/区域/地图/设置）
|- [x] TabBar底部安全距离适配
|- [x] 创建数据模型 (`model/PollenModels.ets`)
|- [x] 创建API服务层 (`service/PollenService.ets`)
|- [x] 配置网络权限 (`module.json5`)
|- [x] 集成API到PollenIndexView
|- [x] **AWS Lambda + API Gateway 部署成功**（2025-12-06）
|- [x] GPS 定位功能
|- [x] 城市搜索与关注
|- [x] 区域列表滑动操作
|- [x] **Service Widget 2x2** - 桌面花粉卡片
|- [x] **花粉过敏自测问卷** - 用户画像收集
|- [x] **冬季非花粉季体验优化** (2025-12-11)
  - Swiper三页：5天预报 + 本月统计 + 全年回顾
  - 防护指南智能切换（花粉季显示防护建议/非花粉季显示健康提示）
|- [x] **长按预览交互** - 220ms + 震动反馈
|- [x] **反馈建议底部弹窗** - SettingsView 中添加
|- [x] **首屏无障碍适配** - accessibilityText
|- [x] **下拉刷新功能** - 首页和区域页 (2025-12-11)
  - 首页：天气先返回结束动画，花粉静默后台更新
  - 区域页：快速刷新距离 + 静默 GPS 定位
|- [x] **状态栏/导航栏颜色优化** (2025-12-11)
  - 状态栏完全透明化
  - 深浅色模式自动适配
|- [x] **花粉浓度主题色系统** (2025-12-11)
  - Tab栏选中态颜色随花粉等级变化
  - 花粉圆环颜色动态变化
  - 5天趋势柱状图颜色动态变化
  - 全年趋势图颜色动态变化
  - 天气图标颜色动态变化
  - 区域页箭头/收藏按钮颜色动态变化
|- [x] **区域页交互优化** (2025-12-12) ✨ 最新
  - 点击城市切换: 30ms 震动 + Toast 提示 "已切换到 XXX市"
  - 收藏城市: 25ms 震动 + Toast 提示 "已收藏/已取消收藏 XXX"
  - 置顶城市: 25ms 震动 + Toast 提示 "已置顶 XXX"
  - 引入: @kit.SensorServiceKit (vibrator) + @kit.ArkUI (promptAction)
|- [x] **启动页优化** (2025-12-12)
  - 启动图标切换为 layered_image（分层图标）
  - 背景色改为 #E3F2FD（天气主题浅蓝色）
|- [x] **版本升级** (2025-12-12)
  - 版本号: 1.0.0 → 1.0.1
  - versionCode: 1000001 → 1000002
  - 目的: 强制重装应用测试新证书
|- [x] **沉浸式状态栏适配** (2025-12-17) ✨ 最新
  - 导航栏背景改为浅色半透明（适配深色状态栏图标）
  - EntryAbility: 浅色模式状态栏图标改为 `#1F1F1F`（深色）
  - 使用颜色资源：`navbar_background` / `navbar_border`
  - 全页面统一背景色方案（首页/区域/地图/设置）

#### 当前进行中 🔄
- 暂无进行中的任务

#### 已完成（待发布）✅
|- [x] **API 17 兼容性改造** (2026-01-05)
  - ✅ 创建 `ApiVersionUtils.ets` API 版本检测工具类
  - ✅ 修改 `MapView.ets` 添加事件监听兼容处理
  - ✅ 修改 `GeneralSettingsPage.ets` 智感握姿 API 兼容 UI
  - ✅ Git 提交 `d977351`
|- [x] **API 17 真机验证** (2026-01-13)
  - ✅ 验证 `controller.on('markerClick')` 事件监听 - 已通过
  - ✅ 验证 `animateCamera()` 坐标转换需求 - 已通过
  - ✅ 验证 `MarkerOptions.snippet` 属性有效性 - 已通过
  - ✅ 用户确认已通过真机测试
|- [x] **导航栏毛玻璃效果修复** (2026-01-13)
  - ✅ 已替换成其他方案（浅色半透明背景 + backdropBlur，适配深色状态栏图标）
  - ✅ 用户确认方案可行

#### 待办 📋 (AppGallery审核反馈)
|- [x] 医疗免责声明添加（可通过调整文案规避）- ✅ 已完成
|- [x] API 17 真机验证后发布新版本 - ✅ 已完成

### 服务器部署架构 🌐 (2026-01-06 更新)

**多服务器故障转移架构** - 高可用性保障

#### 花粉数据服务器（主从架构）

1. **AWS Lambda 东京（主服务器）** ⭐
   - URL: https://g7d8o7pf5b.execute-api.ap-northeast-1.amazonaws.com/default/pollen-api
   - 功能: 每30分钟调用 Google API + 写入 DynamoDB
   - 缓存: 内存缓存 + DynamoDB（30分钟 TTL）
   - 状态: ✅ 生产环境运行中
   - 优先级: 1（主服务器）

2. **AWS Lambda 新加坡（副服务器）**
   - URL: https://8de0lncs7f.execute-api.ap-southeast-1.amazonaws.com/default/pollen-api-singapore
   - 功能: DynamoDB 读取 + 兜底调用 Google API
   - 缓存: DynamoDB（30分钟 TTL）
   - 状态: ✅ 生产环境运行中
   - 优先级: 2（副服务器）

3. **阿里云新加坡（只读服务器）**
   - URL: http://47.84.1.164:5000/pollen-api
   - 功能: 只读 DynamoDB（不调用 Google API）
   - 缓存: DynamoDB（30分钟 TTL）
   - 状态: ✅ 生产环境运行中
   - 优先级: 3（只读备用）
   - 内存占用: ~50MB（简化版，减少 75%）
   - 技术栈: Node.js v18.20.8 + Express + AWS SDK + PM2

#### 共享存储

**AWS DynamoDB（东京区域）**
- 表名: `pollen_cache`
- 分区键: `cache_key` (String)
- TTL: `expire_time` (Number, 30分钟)
- 作用: 主从服务器数据共享
- 状态: ✅ 已配置

#### 天气数据服务器

**百度云广州服务器 - 和风天气 + Minshu花粉 API 代理**
- URL: http://106.12.143.105:3000
- 作用: 代理和风天气 API + Minshu 花粉数据 API，保护 API Key 不暴露在客户端
- 状态: ✅ 生产环境运行中（2025-12-13 部署，2026-01-15 深度优化）
- 部署路径: /root/pollen-api/
- 技术栈: Node.js v20.19.6 + Express + node-cache (15分钟缓存) + SQLite + PM2
- 版本: v1.2.0
- 核心逻辑更新:
  - ✅ **Minshu 接口修复**: 修正 URL 格式为 `/day/pollen/{recordDate}/{adcode}?apikey={key}`
  - ✅ **环境加载**: 实现 `loadEnv()` 自动读取 `.env` 配置
  - ✅ **数据持久化**: 使用 SQLite 存储 Minshu 历史数据
  - ✅ **保留策略**: 自动清理 7 天前的旧数据
  - ✅ **定时任务**: Crontab 每天 23:55 自动批量抓取
- 端点:
  - [和风天气]
   - GET /weather/now?location={lng},{lat}
   - GET /weather/7d?location={lng},{lat}
   - GET /astronomy/sun?location={lng},{lat}&date=YYYYMMDD
  - [Minshu花粉]（仅授权花粉数据）
   - GET /minshu/pollen/day?adcode={城市编码}&recordDate={yyyy-MM-dd}
  - GET /health (健康检查)
- 响应速度: 50-300ms（国内服务器，极快）

**架构优势**:
- ✅ 主服务器故障 → 自动切换到副服务器
- ✅ 副服务器故障 → 自动切换到只读服务器
- ✅ DynamoDB 共享缓存，减少 Google API 调用（每月约 1440 次，远低于 5000 免费额度）
- ✅ 阿里云内存占用减少 75%，避免 OOM 问题

### API 配置信息

**阿里云新加坡节点（当前使用）：**
```
http://47.84.1.164:5000/pollen-api?lat=23.12&lng=113.26&days=5
```
- ✅ 国内可直接访问
- ✅ 替代 AWS Lambda（AWS 新加坡节点已不可用）

**Google Pollen API Key：**
```
AIzaSyCqWhX-k3H5kONC2WV3DtcIs8PtkwdmMH8
```

**Minshu 城市过敏预报 API：**
- API Key: `AK-lYpA8KnbT0lzPNvfjIqCSLDMLPz1n3htrENs`
- 截止日期: 2026-07-01
- 授权范围: 花粉当天24h、花粉未来5天（仅花粉数据，未授权城市过敏指数等其他接口）
- 基础URL: `https://cdn.myminshu.com`
- 代理接口: `http://106.12.143.105:3000/minshu/pollen/day?adcode={adcode}&recordDate={yyyy-MM-dd}`
- 城市覆盖: 全国省市区县（adcode 编码表见 `figma/日志.md`）
- 数据格式: JSON，包含 `pollenTypeInfo`（树花粉/草花粉/禾本科）、`plantInfo`（具体植物信息）、`todayAllergy`（过敏等级和建议）
- ⚠️ **重要经验**：
  - API Key 授权是**按接口类型**的，只授权花粉数据就不能调用城市过敏指数等其他接口
  - 请求格式要**简单直接**，不需要 URL 编码 API Key，不需要额外 header，直接拼接 URL 即可
  - 502 错误通常是请求格式问题，回退到最简单版本就能解决

**备注：** 当前是冬季（12月），全球花粉活动低，API 返回数据中无 indexInfo。春季（3-5月）将有完整花粉浓度数据。

### 代码备份记录 💾

|| 备份时间 | 版本 | 路径 | 大小 | 说明 |
||---------|------|------|------|------|
|| 2026-01-15 16:00 | v1.1.0 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.1.0_20260115_160000` | - | 收藏功能重构与版本升级后的备份✨ |
|| 2026-01-13 22:55 | v1.0.2 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.0.2_20260113_225500` | - | 三级菜单直辖市修复后的备份✨ |
|| 2026-01-10 17:11 | v1.0.2 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.0.2_20260110_171156` | 12.99 MB | 项目备份规则建立后的备份（已修复配置）✨ |
|| 2026-01-06 01:41 | v1.0.2 | Git 提交 `6655b3b` | - | 用户可选择的多数据源架构（PollenDataSource + 适配器接口 + 设置UI） |
|| 2026-01-10 13:04 | v1.0.2 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.0.2_20260110_130400` | - | 区域Tab优化方案制定后的备份 |
|| 2026-01-06 01:41 | v1.0.2 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.0.2_20260106_014100` | - | 多数据源架构完成后的备份 |
|| 2026-01-05 17:30 | v1.0.1 | Git 提交 `d977351` | - | API 17 兼容性实施（ApiVersionUtils + 事件监听兼容） |
|| 2026-01-05 16:21 | v1.0.1 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.0.1_20260105_162141` | 15.85 MB | API 17兼容性咨询文档 + MapKit功能清单 |
|| 2025-12-12 23:34 | v1.0.1 | `C:\HarmonyOS_App_Plans\.claude\backup\PollenForecast_v1.0.1_20251212_233433` | 1.73 MB | 交互优化 + 服务器架构完成后的精简可运行版本 |

**备份规则**: 见 `C:\HarmonyOS_App_Plans\.claude\备份规则.md`  
**备份内容**: AppScope、entry/src、配置文件（排除 build/、oh_modules/、figma/、server/、.claude/、.md文件）  
**⚠️ 重要**: 备份前必须确保原项目配置完整（`oh-package.json5` 需有 `modelVersion`，`hvigorfile.ts` 需使用 `appTasks`）

**GitHub仓库**: `https://github.com/y1032359463-cyber/PollenForecast.git`
**最新提交**: `6655b3b` - feat: Add user-selectable multi-data-source architecture

---

## 🎨 UI设计规范

### 主题色板
|| 用途 | 颜色 | 说明 |
||------|------|------|
|| 主色调 | `#4CAF50` | 健康绿 |
|| 低风险 | `#E8F5E9` | 浅绿背景 |
|| 中风险 | `#FFF3E0` | 浅橙背景 |
|| 高风险 | `#FFEBEE` | 浅红背景 |
|| 极高风险 | `#F44336` | 红色警告 |

### 花粉浓度等级
|| 等级 | 数值范围 | 颜色 | 建议 |
||------|----------|------|------|
|| 1级 | 0-30 | 绿色 | 可正常活动 |
|| 2级 | 31-60 | 黄色 | 轻度过敏者注意 |
|| 3级 | 61-90 | 橙色 | 建议佩戴口罩 |
|| 4级 | 91-120 | 红色 | 减少户外活动 |
|| 5级 | >120 | 紫红 | 避免外出 |

---

## ⚠️ 已知问题

- 废弃 API 警告（待批量修复）：`px2vp`、`animateTo`、`onScroll`
- ⚠️ **项目配置问题**（2026-01-10 发现）：
  - 根目录 `oh-package.json5` 已修复：添加了 `modelVersion: "6.0.0"`
  - 根目录 `hvigorfile.ts` 已修复：改为使用 `appTasks`
  - 如果项目无法构建，检查这两个配置文件是否正确

### AppGallery 审核反馈 (2025-12-11)
1. **医疗免责声明缺失** - 需要在应用中添加声明
2. **首屏无障碍适配不足** - 需优化
3. **冬季数据展示空白** - 非花粉季数据为空（已规划优化方案）
4. ~~服务卡片配置路径错误~~ - ✅ 已修复

---

## 🔗 相关资源

### 设计参考
- 开发方案文档: `原生鸿蒙花粉浓度播报应用开发方案.md`

### API文档
- [Google Pollen API](https://developers.google.com/maps/documentation/pollen)
- [中国气象局数据服务](https://data.cma.cn/)
- [HarmonyOS API参考](https://developer.huawei.com/consumer/cn/doc/harmonyos-references)

---

## 📚 技术沉淀

> **详细技术方案**：见 [知识库.md](../../.claude/知识库.md)  
> - ArkTS 语法规则 → `知识库/ArkTS语法.md`  
> - UI 组件配置 → `知识库/UI组件.md`  
> - 第三方 API 集成 → `知识库/第三方API集成.md`  
> - API 兼容性 → `知识库/API兼容性.md`

---

**记住**: 每次开发前先阅读此文档，完成后更新进度！

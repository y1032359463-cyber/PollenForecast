/*
 * SettingsSheet - è®¾ç½®åº•éƒ¨å¼¹çª—
 * Settings Bottom Sheet Component
 */

import { ThemeColors } from '../common/ThemeConfig';
import PreferencesUtils from '../utils/PreferencesUtils';
import { promptAction, router } from '@kit.ArkUI';
import { ThemeConfig } from '../utils/ThemeManager';

@CustomDialog
export struct SettingsSheet {
  @Link vibrateEnabled: boolean;
  @Link soundEnabled: boolean;
  @Link characterType: string;
  @Link buttonShape: string;      // æŒ‰é’®å½¢çŠ¶
  @Link keyboardTheme: string;    // é”®ç›˜ä¸»é¢˜
  @Link buttonBorder: string;     // æŒ‰é”®è¾¹æ¡†
  controller: CustomDialogController;
  currentTheme?: ThemeConfig;
  
  // æ‹–æ‹½ç›¸å…³
  @State dragOffsetY: number = 0;
  @State isDragging: boolean = false;
  @State slideOffsetY: number = 400; // åˆå§‹ä½ç½®åœ¨åº•éƒ¨å¤–,ç”¨äºæ»‘å…¥åŠ¨ç”»
  private startY: number = 0;
  private CLOSE_THRESHOLD: number = 100; // ä¸‹æ»‘100vpå…³é—­
  
  aboutToAppear() {
    // å»¶è¿Ÿæ‰§è¡Œå…¥åœºåŠ¨ç”»,ç¡®ä¿ç»„ä»¶å·²å®Œæˆæ¸²æŸ“
    setTimeout(() => {
      animateTo({
        duration: 300,
        curve: Curve.FastOutSlowIn
      }, () => {
        this.slideOffsetY = 0;
      });
    }, 50);
  }

  /**
   * å…³é—­å¼¹çª—æ—¶çš„æ»‘ä¸‹åŠ¨ç”»
   */
  private closeWithAnimation(): void {
    animateTo({
      duration: 250,
      curve: Curve.FastOutLinearIn
    }, () => {
      this.slideOffsetY = 400;
    });
    // å»¶è¿Ÿå…³é—­ï¼Œç­‰å¾…åŠ¨ç”»å®Œæˆ
    setTimeout(() => {
      this.controller.close();
    }, 250);
  }

  build() {
    Column({ space: 0 }) {
      // çŠ¶æ€æ å®‰å…¨åŒºåŸŸå ä½
      Blank()
        .height(36)
        .width('100%')

      // é¡¶éƒ¨æ‹–æ‹½æ¡
      Row() {
        Divider()
          .width(40)
          .height(4)
          .backgroundColor('#E5E5EA')
          .borderRadius(2)
      }
      .width('100%')
      .height(20)
      .justifyContent(FlexAlign.Center)

      // æ ‡é¢˜
      Text('è®¾ç½®')
        .fontSize(20)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .padding({ left: 20, right: 20, top: 16, bottom: 16 })

      // è®¾ç½®å†…å®¹ - 2åˆ—ç½‘æ ¼å¸ƒå±€ï¼Œç”¨ScrollåŒ…è£¹
      Scroll() {
        Column({ space: 16 }) {
          // ç¬¬ä¸€æ’ï¼šè§’è‰²é€‰æ‹© + é”®ç›˜ä¸»é¢˜
          Row({ space: 16 }) {
            this.buildCharacterCard()
            this.buildKeyboardThemeCard()
          }
          .width('100%')

          // ç¬¬äºŒæ’ï¼šæŒ‰é’®å½¢çŠ¶ + æŒ‰é”®è¾¹æ¡†ï¼ˆå›¾ç‰‡ä¸»é¢˜æ—¶ç¦ç”¨ï¼‰
          Row({ space: 16 }) {
            if (this.keyboardTheme === 'default') {
              this.buildButtonShapeCard()
              this.buildButtonBorderCard()
            } else {
              this.buildDisabledCard('æŒ‰é’®å½¢çŠ¶', 'å›¾ç‰‡ä¸»é¢˜ä¸å¯ç”¨')
              this.buildDisabledCard('æŒ‰é”®è¾¹æ¡†', 'å›¾ç‰‡ä¸»é¢˜ä¸å¯ç”¨')
            }
          }
          .width('100%')

          // ç¬¬ä¸‰æ’ï¼šéŸ³æ•ˆå¼€å…³ + éœ‡åŠ¨å¼€å…³
          Row({ space: 16 }) {
            this.buildSoundCard()
            this.buildVibrateCard()
          }
          .width('100%')

          // ç¬¬å››æ’ï¼šä¸»é¢˜é€‰æ‹©ï¼ˆå•ç‹¬ä¸€è¡Œï¼‰
          Row({ space: 16 }) {
            this.buildThemeCard()
            // ç©ºç™½å ä½ï¼Œä¿æŒå¸ƒå±€ä¸€è‡´
            Column()
              .width('calc(50% - 8vp)')
              .aspectRatio(1)
          }
          .width('100%')

          // ç¬¬äº”æ’ï¼šä½¿ç”¨æ¡æ¬¾å’Œéšç§æ”¿ç­–åˆå¹¶
          this.buildPolicyCard()

          // é¢„ç•™ï¼šå¹¿å‘Šç§»é™¤ï¼ˆéšè—ï¼‰
          // this.buildAdRemovalCard()
        }
        .width('100%')
        .padding({ left: 16, right: 16, bottom: 120 })  // åº•éƒ¨120vpå¡«å……ï¼Œé®ç›–å¯¼èˆªæ¡
      }
      .scrollBar(BarState.Off)
      .edgeEffect(EdgeEffect.Spring)
      .width('100%')
      .layoutWeight(1)
    }
    .width('100%')
    .backgroundColor($r('app.color.bg_main'))
    .borderRadius({ topLeft: 24, topRight: 24 })
    .translate({ y: this.slideOffsetY + this.dragOffsetY })
    .animation({
      duration: this.isDragging ? 0 : 300,
      curve: Curve.EaseOut
    })
    .onTouch((event: TouchEvent) => {
      if (event.type === TouchType.Down) {
        this.startY = event.touches[0].y;
        this.isDragging = true;
      } else if (event.type === TouchType.Move) {
        const deltaY = event.touches[0].y - this.startY;
        // åªå…è®¸å‘ä¸‹æ‹–æ‹½
        if (deltaY > 0) {
          this.dragOffsetY = deltaY;
        }
      } else if (event.type === TouchType.Up || event.type === TouchType.Cancel) {
        this.isDragging = false;
        // åˆ¤æ–­æ˜¯å¦éœ€è¦å…³é—­
        if (this.dragOffsetY > this.CLOSE_THRESHOLD) {
          this.closeWithAnimation();
        }
        this.dragOffsetY = 0;
      }
    })
  }

  /**
   * è§’è‰²é€‰æ‹©å¡ç‰‡ï¼ˆæ–¹å½¢ï¼Œç‚¹å‡»è¿›å…¥è§’è‰²åˆ—è¡¨é¡µï¼‰
   */
  @Builder
  buildCharacterCard() {
    Column({ space: 8 }) {
      // å½“å‰è§’è‰²é¢„è§ˆå›¾ç‰‡ï¼ˆä½¿ç”¨çœŸå®çŒ«å’ªå›¾ç‰‡ï¼‰
      Image($r('app.media.whitecat_body'))
        .width(60)
        .height(60)
        .objectFit(ImageFit.Contain)

      Text('è§’è‰²é€‰æ‹©')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text('å¯çˆ±çŒ«å’ª')
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1) // æ–¹å½¢å¡ç‰‡
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({
      radius: 12,
      color: 'rgba(255, 140, 66, 0.1)',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      // å…ˆå…³é—­å¼¹çª—ï¼Œå†è·³è½¬
      this.controller.close();
      // å»¶è¿Ÿè·³è½¬ï¼Œç¡®ä¿å¼¹çª—å…³é—­åŠ¨ç”»å®Œæˆ
      setTimeout(() => {
        router.pushUrl({ url: 'pages/CharacterSelectPage' })
          .catch((err: Error) => {
            promptAction.showToast({ message: 'é¡µé¢è·³è½¬å¤±è´¥', duration: 2000 });
          });
      }, 100);
    })
  }

  /**
   * éœ‡åŠ¨å¼€å…³å¡ç‰‡ï¼ˆæ–¹å½¢ï¼Œæ— å›¾æ ‡ï¼‰
   */
  @Builder
  buildVibrateCard() {
    Column({ space: 8 }) {
      // å¼€å…³
      Toggle({ type: ToggleType.Switch, isOn: this.vibrateEnabled })
        .selectedColor(ThemeColors.PRIMARY_ORANGE)
        .width(52)
        .height(32)
        .onChange((isOn: boolean) => {
          this.vibrateEnabled = isOn;
          PreferencesUtils.setVibrateEnabled(isOn);
          promptAction.showToast({ message: isOn ? 'éœ‡åŠ¨å·²å¼€å¯' : 'éœ‡åŠ¨å·²å…³é—­', duration: 2000 });
        })

      Text('æŒ‰é”®éœ‡åŠ¨')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text(this.vibrateEnabled ? 'å·²å¼€å¯' : 'å·²å…³é—­')
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1) // æ–¹å½¢å¡ç‰‡
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({
      radius: 12,
      color: 'rgba(255, 140, 66, 0.1)',
      offsetX: 0,
      offsetY: 2
    })
  }

  /**
   * éŸ³æ•ˆå¼€å…³å¡ç‰‡ï¼ˆæ–¹å½¢ï¼‰
   */
  @Builder
  buildSoundCard() {
    Column({ space: 8 }) {
      // å¼€å…³
      Toggle({ type: ToggleType.Switch, isOn: this.soundEnabled })
        .selectedColor(ThemeColors.PRIMARY_ORANGE)
        .width(52)
        .height(32)
        .onChange((isOn: boolean) => {
          this.soundEnabled = isOn;
          PreferencesUtils.setSoundEnabled(isOn);
          promptAction.showToast({ message: isOn ? 'éŸ³æ•ˆå·²å¼€å¯' : 'éŸ³æ•ˆå·²å…³é—­', duration: 2000 });
        })

      Text('æŒ‰é”®éŸ³æ•ˆ')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text(this.soundEnabled ? 'çŒ«å’ªæ•²é”®ç›˜' : 'å·²é™éŸ³')
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1) // æ–¹å½¢å¡ç‰‡
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({
      radius: 12,
      color: 'rgba(255, 140, 66, 0.1)',
      offsetX: 0,
      offsetY: 2
    })
  }

  /**
   * ä¸»é¢˜é€‰æ‹©å¡ç‰‡ï¼ˆæ–¹å½¢ï¼‰
   */
  @Builder
  buildThemeCard() {
    Column({ space: 8 }) {
      // ä¸»é¢˜å›¾æ ‡
      Column()
        .width(40)
        .height(40)
        .backgroundColor('#FF8C42')
        .borderRadius(10)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)

      Text('ä¸»é¢˜é€‰æ‹©')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text('å¤šç§é£æ ¼å¯é€‰')
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1) // æ–¹å½¢å¡ç‰‡
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({
      radius: 12,
      color: 'rgba(255, 140, 66, 0.1)',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      // å…ˆå…³é—­å¼¹çª—ï¼Œå†è·³è½¬
      this.controller.close();
      // å»¶è¿Ÿè·³è½¬ï¼Œç¡®ä¿å¼¹çª—å…³é—­åŠ¨ç”»å®Œæˆ
      setTimeout(() => {
        router.pushUrl({ url: 'pages/ThemeSelectPage' })
          .catch((err: Error) => {
            promptAction.showToast({ message: 'é¡µé¢è·³è½¬å¤±è´¥', duration: 2000 });
          });
      }, 100);
    })
  }

  /**
   * ä½¿ç”¨æ¡æ¬¾å’Œéšç§æ”¿ç­–åˆå¹¶å¡ç‰‡ï¼ˆæ— å›¾æ ‡ï¼Œçº¯æ–‡å­—ï¼‰
   */
  @Builder
  buildPolicyCard() {
    Row({ space: 16 }) {
      // ä½¿ç”¨æ¡æ¬¾
      Column({ space: 8 }) {
        Text('ä½¿ç”¨æ¡æ¬¾')
          .fontSize(14)
          .fontColor($r('app.color.text_primary'))
          .fontWeight(FontWeight.Medium)
      }
      .width('calc(50% - 8vp)')
      .height(60)
      .justifyContent(FlexAlign.Center)
      .backgroundColor($r('app.color.bg_card'))
      .borderRadius(16)
      .shadow({
        radius: 12,
        color: 'rgba(255, 140, 66, 0.1)',
        offsetX: 0,
        offsetY: 2
      })
      .onClick(() => {
        this.showTermsDialog();
      })

      // éšç§æ”¿ç­–
      Column({ space: 8 }) {
        Text('éšç§æ”¿ç­–')
          .fontSize(14)
          .fontColor($r('app.color.text_primary'))
          .fontWeight(FontWeight.Medium)
      }
      .width('calc(50% - 8vp)')
      .height(60)
      .justifyContent(FlexAlign.Center)
      .backgroundColor($r('app.color.bg_card'))
      .borderRadius(16)
      .shadow({
        radius: 12,
        color: 'rgba(255, 140, 66, 0.1)',
        offsetX: 0,
        offsetY: 2
      })
      .onClick(() => {
        this.showPrivacyDialog();
      })
    }
    .width('100%')
  }

  /**
   * æ˜¾ç¤ºä½¿ç”¨æ¡æ¬¾å¯¹è¯æ¡†
   */
  private showTermsDialog(): void {
    promptAction.showDialog({
      title: 'ä½¿ç”¨æ¡æ¬¾',
      message: 'æ„Ÿè°¢æ‚¨ä½¿ç”¨å¡é€šå–µè®¡ç®—å™¨ï¼\n\næœ¬åº”ç”¨ä¸ºå…è´¹è®¡ç®—å·¥å…·ï¼Œä»…ä¾›ä¸ªäººå­¦ä¹ å’Œæ—¥å¸¸ä½¿ç”¨ã€‚\n\næˆ‘ä»¬æ‰¿è¯ºä¸ä¼šæ”¶é›†æ‚¨çš„ä»»ä½•ä¸ªäººä¿¡æ¯ã€‚',
      buttons: [
        { text: 'æˆ‘çŸ¥é“äº†', color: ThemeColors.PRIMARY_ORANGE }
      ]
    }).catch((err: Error) => {
      console.error('Dialog error:', err);
    });
  }

  /**
   * æ˜¾ç¤ºéšç§æ”¿ç­–å¯¹è¯æ¡†
   */
  private showPrivacyDialog(): void {
    promptAction.showDialog({
      title: 'éšç§æ”¿ç­–',
      message: 'å¡é€šå–µè®¡ç®—å™¨é‡è§†æ‚¨çš„éšç§ä¿æŠ¤ï¼š\n\nâœ“ ä¸æ”¶é›†ä¸ªäººä¿¡æ¯\nâœ“ ä¸ä¸Šä¼ ä½¿ç”¨æ•°æ®\nâœ“ æ‰€æœ‰è®¡ç®—æœ¬åœ°å®Œæˆ\nâœ“ å†å²è®°å½•ä»…ä¿å­˜åœ¨æœ¬åœ°\n\næ‚¨çš„æ•°æ®å®‰å…¨ç”±HarmonyOSç³»ç»Ÿä¿æŠ¤ã€‚',
      buttons: [
        { text: 'æˆ‘çŸ¥é“äº†', color: ThemeColors.PRIMARY_ORANGE }
      ]
    }).catch((err: Error) => {
      console.error('Dialog error:', err);
    });
  }

  /**
   * å¹¿å‘Šç§»é™¤å¡ç‰‡ï¼ˆé¢„ç•™æ¥å£ï¼‰
   */
  @Builder
  buildAdRemovalCard() {
    Row() {
      Row({ space: 12 }) {
        Column() {
          Text('ğŸš«')
            .fontSize(32)
        }
        .width(60)
        .height(60)
        .backgroundColor('#FFF5E6')
        .borderRadius(12)
        .justifyContent(FlexAlign.Center)

        Column({ space: 4 }) {
          Text('ç§»é™¤å¹¿å‘Š')
            .fontSize(16)
            .fontColor(ThemeColors.TEXT_PRIMARY)
            .fontWeight(FontWeight.Medium)
          Text('æ°¸ä¹…äº«å—æ— å¹¿å‘Šä½“éªŒ')
            .fontSize(12)
            .fontColor(ThemeColors.TEXT_SECONDARY)
        }
        .alignItems(HorizontalAlign.Start)
      }

      Blank()

      Button('Â¥6')
        .width(60)
        .height(36)
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .backgroundColor(ThemeColors.PRIMARY_ORANGE)
        .fontColor('#FFFFFF')
        .borderRadius(18)
        .onClick(() => {
          promptAction.showToast({ message: 'åŠŸèƒ½å¼€å‘ä¸­...', duration: 2000 });
        })
    }
    .width('100%')
    .padding(16)
    .backgroundColor(ThemeColors.BG_CARD)
    .borderRadius(16)
    .shadow({ 
      radius: 12, 
      color: 'rgba(255, 140, 66, 0.1)', 
      offsetX: 0, 
      offsetY: 2 
    })
  }

  /**
   * ç¦ç”¨çŠ¶æ€çš„å¡ç‰‡ï¼ˆå›¾ç‰‡ä¸»é¢˜æ—¶æ˜¾ç¤ºï¼‰
   */
  @Builder
  buildDisabledCard(title: string, hint: string) {
    Column({ space: 8 }) {
      // ç¦ç”¨å›¾æ ‡
      Column()
        .width(40)
        .height(40)
        .backgroundColor('#E0E0E0')
        .borderRadius(10)

      Text(title)
        .fontSize(14)
        .fontColor('#999999')
        .fontWeight(FontWeight.Medium)

      Text(hint)
        .fontSize(12)
        .fontColor('#BBBBBB')
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1)
    .justifyContent(FlexAlign.Center)
    .backgroundColor('#F5F5F5')
    .borderRadius(16)
    .opacity(0.6)
  }

  /**
   * æŒ‰é’®å½¢çŠ¶é€‰æ‹©å¡ç‰‡
   */
  @Builder
  buildButtonShapeCard() {
    Column({ space: 8 }) {
      // å½¢çŠ¶é¢„è§ˆå›¾æ ‡ - æ ¹æ®å½“å‰é€‰æ‹©æ˜¾ç¤º
      if (this.buttonShape === 'circle') {
        Column()
          .width(40)
          .height(40)
          .backgroundColor('#4ECDC4')
          .borderRadius(20) // åœ†å½¢
      } else {
        Column()
          .width(40)
          .height(40)
          .backgroundColor('#4ECDC4')
          .borderRadius(10) // åœ†è§’
      }

      Text('æŒ‰é’®å½¢çŠ¶')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text(this.buttonShape === 'circle' ? 'åœ†å½¢' : 'åœ†è§’æ–¹å½¢')
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1)
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({ 
      radius: 12, 
      color: 'rgba(255, 140, 66, 0.1)', 
      offsetX: 0, 
      offsetY: 2 
    })
    .onClick(() => {
      this.controller.close();
      setTimeout(() => {
        router.pushUrl({ url: 'pages/ButtonShapeSelectPage' })
          .catch((err: Error) => {
            promptAction.showToast({ message: 'é¡µé¢è·³è½¬å¤±è´¥', duration: 2000 });
          });
      }, 100);
    })
  }

  /**
   * é”®ç›˜ä¸»é¢˜é€‰æ‹©å¡ç‰‡
   */
  @Builder
  buildKeyboardThemeCard() {
    Column({ space: 8 }) {
      // ä¸»é¢˜é¢„è§ˆå›¾æ ‡
      Image(this.getKeyboardThemeIcon())
        .width(40)
        .height(40)
        .objectFit(ImageFit.Contain)

      Text('é”®ç›˜ä¸»é¢˜')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text(this.getKeyboardThemeName())
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1)
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({ 
      radius: 12, 
      color: 'rgba(255, 140, 66, 0.1)', 
      offsetX: 0, 
      offsetY: 2 
    })
    .onClick(() => {
      this.controller.close();
      setTimeout(() => {
        router.pushUrl({ url: 'pages/KeyboardThemeSelectPage' })
          .catch((err: Error) => {
            promptAction.showToast({ message: 'é¡µé¢è·³è½¬å¤±è´¥', duration: 2000 });
          });
      }, 100);
    })
  }

  /**
   * æŒ‰é”®è¾¹æ¡†é€‰æ‹©å¡ç‰‡
   */
  @Builder
  buildButtonBorderCard() {
    Column({ space: 8 }) {
      // è¾¹æ¡†é£æ ¼é¢„è§ˆ
      this.buildBorderPreview()

      Text('æŒ‰é”®è¾¹æ¡†')
        .fontSize(14)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)

      Text(this.getButtonBorderName())
        .fontSize(12)
        .fontColor($r('app.color.text_secondary'))
    }
    .width('calc(50% - 8vp)')
    .aspectRatio(1)
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.bg_card'))
    .borderRadius(16)
    .shadow({ 
      radius: 12, 
      color: 'rgba(255, 140, 66, 0.1)', 
      offsetX: 0, 
      offsetY: 2 
    })
    .onClick(() => {
      this.controller.close();
      setTimeout(() => {
        router.pushUrl({ url: 'pages/ButtonBorderSelectPage' })
          .catch((err: Error) => {
            promptAction.showToast({ message: 'é¡µé¢è·³è½¬å¤±è´¥', duration: 2000 });
          });
      }, 100);
    })
  }

  /**
   * è·å–é”®ç›˜ä¸»é¢˜å›¾æ ‡ï¼ˆç”¨äºè®¾ç½®é¡µé¢é¢„è§ˆï¼Œä½¿ç”¨ normal çŠ¶æ€ï¼‰
   * æ³¨æ„ï¼šç›®å‰åªæœ‰ catpaw ä¸»é¢˜æœ‰å›¾ç‰‡ï¼Œå…¶ä»–ä¸»é¢˜è¿”å› catpaw å›¾ç‰‡ä½œä¸ºå ä½
   */
  private getKeyboardThemeIcon(): Resource {
    switch (this.keyboardTheme) {
      case 'catpaw': return $rawfile('keyboard_themes/catpaw/catpaw_5_normal.png');
      case 'star': return $rawfile('keyboard_themes/catpaw/catpaw_5_normal.png'); // TODO: å¾…æ·»åŠ  star ä¸»é¢˜å›¾ç‰‡
      case 'heart': return $rawfile('keyboard_themes/catpaw/catpaw_5_normal.png'); // TODO: å¾…æ·»åŠ  heart ä¸»é¢˜å›¾ç‰‡
      case 'cloud': return $rawfile('keyboard_themes/catpaw/catpaw_5_normal.png'); // TODO: å¾…æ·»åŠ  cloud ä¸»é¢˜å›¾ç‰‡
      default: return $rawfile('keyboard_themes/catpaw/catpaw_5_normal.png'); // ä½¿ç”¨ catpaw ä½œä¸ºé»˜è®¤å›¾æ ‡
    }
  }

  /**
   * è·å–é”®ç›˜ä¸»é¢˜åç§°
   */
  private getKeyboardThemeName(): string {
    switch (this.keyboardTheme) {
      case 'catpaw': return 'çŒ«çˆª';
      case 'star': return 'æ˜Ÿæ˜Ÿ';
      case 'heart': return 'çˆ±å¿ƒ';
      case 'cloud': return 'äº‘æœµ';
      default: return 'é»˜è®¤';
    }
  }

  /**
   * è·å–æŒ‰é”®è¾¹æ¡†åç§°
   */
  private getButtonBorderName(): string {
    switch (this.buttonBorder) {
      case 'flat': return 'æ‰å¹³';
      case '3d': return '3Dç«‹ä½“';
      case 'neon': return 'éœ“è™¹å‘å…‰';
      case 'pixel': return 'åƒç´ å¤å¤';
      default: return 'æ‰å¹³';
    }
  }

  /**
   * è¾¹æ¡†é¢„è§ˆæ„å»ºå™¨
   */
  @Builder
  buildBorderPreview() {
    if (this.buttonBorder === 'flat') {
      Column()
        .width(40)
        .height(40)
        .backgroundColor('#FF6B6B')
        .borderRadius(8)
    } else if (this.buttonBorder === '3d') {
      Column()
        .width(40)
        .height(40)
        .backgroundColor('#FF6B6B')
        .borderRadius(8)
        .shadow({ radius: 0, color: '#CC5555', offsetX: 0, offsetY: 4 })
        .border({ width: { bottom: 4 }, color: '#CC5555' })
    } else if (this.buttonBorder === 'neon') {
      Column()
        .width(40)
        .height(40)
        .backgroundColor('rgba(255, 107, 107, 0.3)')
        .borderRadius(8)
        .border({ width: 2, color: '#FF6B6B' })
        .shadow({ radius: 12, color: 'rgba(255, 107, 107, 0.6)', offsetX: 0, offsetY: 0 })
    } else {
      // pixel
      Column()
        .width(40)
        .height(40)
        .backgroundColor('#FF6B6B')
        .borderRadius(0)
        .border({ width: 3, color: '#000000' })
    }
  }
}

# èŠ±ç²‰ API æœåŠ¡

> éƒ¨ç½²åœ¨å¹¿å·ç™¾åº¦äº‘æœåŠ¡å™¨çš„èŠ±ç²‰æ•°æ®ä»£ç†æœåŠ¡

---

## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯

- **IP**: 106.12.143.105
- **ç«¯å£**: 3000
- **ä½ç½®**: å¹¿å·
- **å¸¦å®½**: 2Mbps

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ–¹å¼ 1: ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
cd C:\HarmonyOS_App_Plans\PollenForecast\server
.\upload-and-deploy.ps1
```

### æ–¹å¼ 2: æ‰‹åŠ¨éƒ¨ç½²

1. **ä¸Šä¼ ä»£ç **
   ```powershell
   .\quick-upload.ps1
   ```

2. **SSH ç™»å½•æœåŠ¡å™¨**
   ```bash
   ssh root@106.12.143.105
   ```

3. **æ‰§è¡Œéƒ¨ç½²**
   ```bash
   cd /root/pollen-api
   bash deploy.sh
   ```

---

## ğŸ“¡ æ¥å£æ–‡æ¡£

### å¥åº·æ£€æŸ¥
```
GET http://106.12.143.105:3000/health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "ok",
  "timestamp": "2025-12-12T10:30:00.000Z",
  "server": "å¹¿å·ç™¾åº¦äº‘",
  "version": "1.0.0"
}
```

### èŠ±ç²‰æŸ¥è¯¢
```
GET http://106.12.143.105:3000/pollen-api?lat=<çº¬åº¦>&lng=<ç»åº¦>&days=<å¤©æ•°>
```

**å‚æ•°**:
- `lat`: çº¬åº¦ï¼ˆå¿…éœ€ï¼‰
- `lng`: ç»åº¦ï¼ˆå¿…éœ€ï¼‰
- `days`: é¢„æŠ¥å¤©æ•°ï¼Œé»˜è®¤ 5ï¼ˆå¯é€‰ï¼‰

**ç¤ºä¾‹**:
```bash
# å¹¿å·èŠ±ç²‰æ•°æ®
curl "http://106.12.143.105:3000/pollen-api?lat=23.1291&lng=113.2644&days=5"
```

---

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
pm2 status
```

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
pm2 logs pollen-api
```

### é‡å¯æœåŠ¡
```bash
pm2 restart pollen-api
```

### åœæ­¢æœåŠ¡
```bash
pm2 stop pollen-api
```

---

## ğŸ“± å®¢æˆ·ç«¯é›†æˆ

ä¿®æ”¹ `PollenService.ets` ä¸­çš„ API åœ°å€ï¼š

```typescript
// åŸåœ°å€ï¼ˆAWS Lambdaï¼‰
const POLLEN_API_BASE_URL = 'https://iigtw47lrd.execute-api.ap-southeast-1.amazonaws.com/default/pollen-api'

// æ–°åœ°å€ï¼ˆå¹¿å·æœåŠ¡å™¨ï¼‰
const POLLEN_API_BASE_URL = 'http://106.12.143.105:3000/pollen-api'
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env)
```env
GOOGLE_POLLEN_API_KEY=ä½ çš„APIå¯†é’¥
PORT=3000
```

### ç¼“å­˜é…ç½®
- **ç¼“å­˜æ—¶é•¿**: 15 åˆ†é’Ÿ
- **ç¼“å­˜å¼•æ“**: node-cacheï¼ˆå†…å­˜ï¼‰
- **ç¼“å­˜é”®**: `pollen_{çº¬åº¦}_{ç»åº¦}_{å¤©æ•°}`

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. **é…ç½®é˜²ç«å¢™**
   - ä»…å¼€æ”¾ 3000 ç«¯å£
   - é™åˆ¶ SSH ç«¯å£è®¿é—®

2. **ä½¿ç”¨ HTTPS**
   - é…ç½® SSL è¯ä¹¦
   - é€šè¿‡ Nginx åå‘ä»£ç†

3. **API Key ä¿æŠ¤**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡
   - ä¸è¦æäº¤åˆ° Git

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 200msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
- **å¹¶å‘èƒ½åŠ›**: ~100 req/sï¼ˆ2Mbps å¸¦å®½é™åˆ¶ï¼‰
- **ç¼“å­˜å‘½ä¸­ç‡**: é¢„è®¡ >80%

---

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡æ— å“åº”
```bash
# æ£€æŸ¥è¿›ç¨‹
pm2 status

# é‡å¯æœåŠ¡
pm2 restart pollen-api

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs pollen-api --err
```

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i :3000

# ç»“æŸè¿›ç¨‹
kill -9 <PID>
```

### Google API è°ƒç”¨å¤±è´¥
```bash
# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
curl -I https://pollen.googleapis.com

# æ£€æŸ¥ API Key
cat .env | grep GOOGLE_POLLEN_API_KEY
```

---

## ğŸ“ æ›´æ–°è®°å½•

### v1.0.0 (2025-12-12)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… æ”¯æŒèŠ±ç²‰æ•°æ®æŸ¥è¯¢
- âœ… 15åˆ†é’Ÿç¼“å­˜æœºåˆ¶
- âœ… CORS è·¨åŸŸæ”¯æŒ

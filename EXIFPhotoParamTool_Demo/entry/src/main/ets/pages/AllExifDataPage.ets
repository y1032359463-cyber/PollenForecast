/**
 * å®Œæ•´EXIFæ•°æ®é¡µ - æ˜¾ç¤ºæ‰€æœ‰70+å­—æ®µï¼ˆåŒ…æ‹¬ç©ºå€¼ï¼‰
 */
import { PhotoRecord } from '../models/PhotoRecord'
import { Router } from '@kit.ArkUI'
import { hilog } from '@kit.PerformanceAnalysisKit'

interface RouteParams {
  record: PhotoRecord
}

interface ExifItem {
  label: string
  value: string
}

interface FieldCount {
  total: number
  nonEmpty: number
}

@Entry
@Component
struct AllExifDataPage {
  @State record: PhotoRecord | null = null
  @State expandedGroups: Set<string> = new Set(['ğŸ“¸ æ‹æ‘„å‚æ•°'])  // é»˜è®¤åªå±•å¼€æ‹æ‘„å‚æ•°

  aboutToAppear(): void {
    const routerInstance: Router = this.getUIContext().getRouter()
    const params = routerInstance.getParams() as RouteParams
    if (params && params.record) {
      this.record = params.record
      hilog.info(0x0021, 'EXIF', '[AllExif] åŠ è½½è®°å½•:' + JSON.stringify(this.record))
      
      // === è°ƒè¯•DNGå­—æ®µæ•°æ® ===
      hilog.error(0x0021, 'EXIF', '[AllExif-DNG] ğŸ”´ æ£€æŸ¥DNGå­—æ®µå€¼ ğŸ”´')
      hilog.error(0x0021, 'EXIF', `[AllExif-DNG] dngVersion: ${this.record.exifData.dngVersion}`)
      hilog.error(0x0021, 'EXIF', `[AllExif-DNG] dngBackwardVersion: ${this.record.exifData.dngBackwardVersion}`)
      hilog.error(0x0021, 'EXIF', `[AllExif-DNG] uniqueCameraModel: ${this.record.exifData.uniqueCameraModel}`)
      hilog.error(0x0021, 'EXIF', `[AllExif-DNG] cameraSerialNumberDNG: ${this.record.exifData.cameraSerialNumberDNG}`)
      hilog.error(0x0021, 'EXIF', `[AllExif-DNG] dngLensInfo: ${this.record.exifData.dngLensInfo}`)
      hilog.error(0x0021, 'EXIF', `[AllExif-DNG] baselineExposure: ${this.record.exifData.baselineExposure}`)
    }
  }

  // åˆ‡æ¢åˆ†ç»„å±•å¼€/æŠ˜å çŠ¶æ€
  private toggleGroup(groupName: string): void {
    if (this.expandedGroups.has(groupName)) {
      this.expandedGroups.delete(groupName)
    } else {
      this.expandedGroups.add(groupName)
    }
    // è§¦å‘å“åº”å¼æ›´æ–°ï¼ˆArkTSè¦æ±‚é‡æ–°èµ‹å€¼ï¼‰
    this.expandedGroups = new Set(this.expandedGroups)
  }

  // è®¡ç®—æ€»å­—æ®µæ•°å’Œéç©ºå­—æ®µæ•°
  private getTotalFieldCount(): FieldCount {
    if (!this.record) {
      const emptyCount: FieldCount = { total: 0, nonEmpty: 0 }
      return emptyCount
    }
    
    const allSections = [
      this.getShootingParams(),
      this.getCameraParams(),
      this.getLensParams(),
      this.getGpsParams(),
      this.getTimeParams(),
      this.getImageParams(),
      this.getExposureParams(),
      this.getFlashParams(),
      this.getFocusParams(),
      this.getColorParams(),
      this.getAdjustmentParams(),
      this.getSceneParams(),
      this.getResolutionParams(),
      this.getMetadataParams(),
      this.getTechnicalParams(),
      this.getDngParams()  // âœ… æ–°å¢ï¼šåŒ…å«DNGä¸“æœ‰å‚æ•°åˆ†ç»„
    ]
    
    let total = 0
    let nonEmpty = 0
    
    allSections.forEach(section => {
      section.forEach(item => {
        total++
        if (item.value !== '-') {
          nonEmpty++
        }
      })
    })
    
    const result: FieldCount = { total: total, nonEmpty: nonEmpty }
    return result
  }

  // è®¡ç®—å•ä¸ªåˆ†ç»„çš„å­—æ®µæ•°
  private getSectionFieldCount(items: ExifItem[]): FieldCount {
    const total = items.length
    const nonEmpty = items.filter(item => item.value !== '-').length
    const result: FieldCount = { total: total, nonEmpty: nonEmpty }
    return result
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('â†')
          .fontSize(24)
          .fontColor('#333333')
          .onClick(() => {
            this.getUIContext().getRouter().back()
          })
        
        Text('å®Œæ•´EXIFæ•°æ®')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
          .margin({ left: 16 })
        
        Blank()
        
        // æ€»å­—æ®µæ•°ç»Ÿè®¡
        if (this.record) {
          Text(`${this.getTotalFieldCount().nonEmpty}/${this.getTotalFieldCount().total}`)
            .fontSize(14)
            .fontColor('#999999')
            .margin({ right: 8 })
        }
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor(Color.White)

      if (this.record) {
        Scroll() {
          Column() {
            // === P0 æ ¸å¿ƒå‚æ•° ===
            // æ‹æ‘„å‚æ•°
            this.ExifSection('ğŸ“¸ æ‹æ‘„å‚æ•°', this.getShootingParams())
            
            // ç›¸æœºä¿¡æ¯
            this.ExifSection('ğŸ“· ç›¸æœºä¿¡æ¯', this.getCameraParams())
            
            // é•œå¤´å‚æ•°
            this.ExifSection('ğŸ”­ é•œå¤´å‚æ•°', this.getLensParams())
            
            // GPSå®šä½
            this.ExifSection('ğŸ“ GPSå®šä½', this.getGpsParams())
            
            // æ—¶é—´ä¿¡æ¯
            this.ExifSection('â° æ—¶é—´ä¿¡æ¯', this.getTimeParams())
            
            // å›¾åƒå±æ€§
            this.ExifSection('ğŸ–¼ï¸ å›¾åƒå±æ€§', this.getImageParams())
            
            // === P1 è¿›é˜¶å‚æ•° ===
            // æ›å…‰æ§åˆ¶
            this.ExifSection('ğŸ”† æ›å…‰æ§åˆ¶', this.getExposureParams())
            
            // é—ªå…‰ç¯
            this.ExifSection('âš¡ é—ªå…‰ç¯', this.getFlashParams())
            
            // å¯¹ç„¦æµ‹è·
            this.ExifSection('ğŸ¯ å¯¹ç„¦æµ‹è·', this.getFocusParams())
            
            // ç™½å¹³è¡¡ä¸è‰²å½©
            this.ExifSection('ğŸ¨ ç™½å¹³è¡¡ä¸è‰²å½©', this.getColorParams())
            
            // å›¾åƒè°ƒæ•´
            this.ExifSection('ğŸ”§ å›¾åƒè°ƒæ•´', this.getAdjustmentParams())
            
            // æ‹æ‘„æ¨¡å¼
            this.ExifSection('ğŸ“ æ‹æ‘„æ¨¡å¼', this.getSceneParams())
            
            // === P2 æŠ€æœ¯å‚æ•° ===
            // åˆ†è¾¨ç‡å‚æ•°
            this.ExifSection('ğŸ“ åˆ†è¾¨ç‡å‚æ•°', this.getResolutionParams())
            
            // æ–‡ä»¶å…ƒæ•°æ®
            this.ExifSection('ğŸ“‹ æ–‡ä»¶å…ƒæ•°æ®', this.getMetadataParams())
            
            // æŠ€æœ¯å‚æ•°
            this.ExifSection('âš™ï¸ æŠ€æœ¯å‚æ•°', this.getTechnicalParams())
            
            // === P0 DNGä¸“æœ‰å‚æ•°ï¼ˆPhase 2æ–°å¢ï¼‰===
            this.ExifSection('ğŸ“¦ DNGä¸“æœ‰å‚æ•°', this.getDngParams())
          }
          .padding(16)
        }
        .width('100%')
        .layoutWeight(1)
      } else {
        Column() {
          Text('âŒ')
            .fontSize(48)
          Text('æ— æ³•åŠ è½½æ•°æ®')
            .fontSize(16)
            .fontColor('#999999')
            .margin({ top: 16 })
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  // === P0 æ ¸å¿ƒå‚æ•° ===
  // æ‹æ‘„å‚æ•°
  private getShootingParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'å…‰åœˆ', value: this.record.exifData.aperture || '-' },
      { label: 'å¿«é—¨é€Ÿåº¦', value: this.record.exifData.shutterSpeed || '-' },
      { label: 'ISOæ„Ÿå…‰åº¦', value: this.record.exifData.iso > 0 ? `ISO ${this.record.exifData.iso}` : '-' },
      { label: 'ç„¦è·', value: this.record.exifData.focalLength || '-' },
      { label: 'ç­‰æ•ˆç„¦è·(35mm)', value: this.record.exifData.focalLengthIn35mm || '-' },
      { label: 'æ›å…‰æ—¶é—´', value: this.record.exifData.exposureTime || '-' },
    ] as ExifItem[]
  }

  // ç›¸æœºä¿¡æ¯
  private getCameraParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'ç›¸æœºå“ç‰Œ', value: this.record.exifData.cameraMake || '-' },
      { label: 'ç›¸æœºå‹å·', value: this.record.exifData.cameraModel || '-' },
      { label: 'æœºèº«åºåˆ—å·', value: this.record.exifData.bodySerialNumber || '-' },
      { label: 'å¤„ç†è½¯ä»¶', value: this.record.exifData.software || '-' },
      { label: 'EXIFç‰ˆæœ¬', value: this.record.exifData.exifVersion || '-' },
    ] as ExifItem[]
  }

  // é•œå¤´å‚æ•°
  private getLensParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'é•œå¤´å‹å·', value: this.record.exifData.lensModel || '-' },
      { label: 'é•œå¤´å“ç‰Œ', value: this.record.exifData.lensMake || '-' },
      { label: 'é•œå¤´åºåˆ—å·', value: this.record.exifData.lensSerialNumber || '-' },
      { label: 'æœ€å¤§å…‰åœˆ', value: this.record.exifData.maxAperture || '-' },
      { label: 'ä¸»ä½“è·ç¦»', value: this.record.exifData.subjectDistance || '-' },
    ] as ExifItem[]
  }

  // GPSå®šä½
  private getGpsParams(): ExifItem[] {
    if (!this.record) return []
    const lat = this.record.exifData.gpsLatitude
    const lon = this.record.exifData.gpsLongitude
    const alt = this.record.exifData.gpsAltitude
    const latRef = this.record.exifData.gpsLatitudeRef
    const lonRef = this.record.exifData.gpsLongitudeRef
    const altRef = this.record.exifData.gpsAltitudeRef
    
    return [
      { label: 'GPSçº¬åº¦', value: lat ? `${lat.toFixed(6)}Â° ${latRef || ''}` : '-' },
      { label: 'GPSç»åº¦', value: lon ? `${lon.toFixed(6)}Â° ${lonRef || ''}` : '-' },
      { label: 'GPSæµ·æ‹”', value: alt ? `${alt.toFixed(1)}m ${altRef || ''}` : '-' },
      { label: 'GPSæµ·æ‹”å‚è€ƒ', value: this.record.exifData.gpsAltitudeRef || '-' },
      { label: 'GPSé€Ÿåº¦', value: this.record.exifData.gpsSpeed || '-' },
      { label: 'GPSå›¾åƒæ–¹å‘', value: this.record.exifData.gpsImgDirection || '-' },
      { label: 'GPSæ—¶é—´æˆ³', value: this.record.exifData.gpsTimeStamp || '-' },
      { label: 'GPSæ—¥æœŸæˆ³', value: this.record.exifData.gpsDateStamp || '-' },
      { label: 'GPSå¤„ç†æ–¹æ³•', value: this.record.exifData.gpsProcessingMethod || '-' },
    ] as ExifItem[]
  }

  // æ—¶é—´ä¿¡æ¯
  private getTimeParams(): ExifItem[] {
    if (!this.record) return []
    const dt = this.record.exifData.dateTime
    const subSec = this.record.exifData.subSecTime
    const dtWithSubSec = (dt && subSec) ? `${dt}.${subSec}` : (dt || '-')
    
    return [
      { label: 'æ‹æ‘„æ—¶é—´', value: dtWithSubSec },
      { label: 'åŸå§‹æ‹æ‘„æ—¶é—´', value: this.record.exifData.dateTimeOriginal || '-' },
      { label: 'æ•°å­—åŒ–æ—¶é—´', value: this.record.exifData.dateTimeDigitized || '-' },
      { label: 'äºšç§’æ—¶é—´', value: this.record.exifData.subSecTime || '-' },
      { label: 'äºšç§’æ—¶é—´(åŸå§‹)', value: this.record.exifData.subSecTimeOriginal || '-' },
      { label: 'äºšç§’æ—¶é—´(æ•°å­—åŒ–)', value: this.record.exifData.subSecTimeDigitized || '-' },
    ] as ExifItem[]
  }

  // å›¾åƒå±æ€§
  private getImageParams(): ExifItem[] {
    if (!this.record) return []
    const width = this.record.exifData.imageWidth
    const height = this.record.exifData.imageHeight
    const sizeStr = (width && height) ? `${width} Ã— ${height}` : '-'
    
    const pixelX = this.record.exifData.pixelXDimension
    const pixelY = this.record.exifData.pixelYDimension
    const pixelStr = (pixelX && pixelY) ? `${pixelX} Ã— ${pixelY}` : '-'
    
    return [
      { label: 'å›¾åƒå°ºå¯¸', value: sizeStr },
      { label: 'æœ‰æ•ˆåƒç´ å°ºå¯¸', value: pixelStr },
      { label: 'å›¾åƒæ–¹å‘', value: this.record.exifData.orientation || '-' },
      { label: 'è‰²å½©ç©ºé—´', value: this.record.exifData.colorSpace || '-' },
      { label: 'æ¯æ ·æœ¬ä½æ•°', value: this.record.exifData.bitsPerSample || '-' },
      { label: 'æ¯åƒç´ æ ·æœ¬æ•°', value: this.record.exifData.samplesPerPixel || '-' },
      { label: 'åˆ†é‡é…ç½®', value: this.record.exifData.componentsConfiguration || '-' },
    ] as ExifItem[]
  }

  // === P1 è¿›é˜¶å‚æ•° ===
  // æ›å…‰æ§åˆ¶
  private getExposureParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'æ›å…‰è¡¥å¿', value: this.record.exifData.exposureCompensation || '-' },
      { label: 'æ›å…‰æ¨¡å¼', value: this.record.exifData.exposureMode || '-' },
      { label: 'æ›å…‰ç¨‹åº', value: this.record.exifData.exposureProgram || '-' },
      { label: 'æµ‹å…‰æ¨¡å¼', value: this.record.exifData.meteringMode || '-' },
      { label: 'æ›å…‰æŒ‡æ•°', value: this.record.exifData.exposureIndex || '-' },
    ] as ExifItem[]
  }

  // é—ªå…‰ç¯
  private getFlashParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'é—ªå…‰ç¯', value: this.record.exifData.flash || '-' },
      { label: 'é—ªå…‰ç¯èƒ½é‡', value: this.record.exifData.flashEnergy || '-' },
      { label: 'å…‰æºç±»å‹', value: this.record.exifData.lightSource || '-' },
    ] as ExifItem[]
  }

  // å¯¹ç„¦æµ‹è·
  private getFocusParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'ä¸»ä½“è·ç¦»', value: this.record.exifData.subjectDistance || '-' },
      { label: 'ä¸»ä½“è·ç¦»èŒƒå›´', value: this.record.exifData.subjectDistanceRange || '-' },
      { label: 'ä¸»ä½“åŒºåŸŸ', value: this.record.exifData.subjectArea || '-' },
      { label: 'ä¸»ä½“ä½ç½®', value: this.record.exifData.subjectLocation || '-' },
      { label: 'æ„Ÿå…‰æ–¹å¼', value: this.record.exifData.sensingMethod || '-' },
    ] as ExifItem[]
  }

  // ç™½å¹³è¡¡ä¸è‰²å½©
  private getColorParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'ç™½å¹³è¡¡', value: this.record.exifData.whiteBalance || '-' },
      { label: 'è‰²å½©ç©ºé—´', value: this.record.exifData.colorSpace || '-' },
      { label: 'ç™½ç‚¹', value: this.record.exifData.whitePoint || '-' },
      { label: 'åŸè‰²åº¦', value: this.record.exifData.primaryChromaticities || '-' },
      { label: 'YCbCrç³»æ•°', value: this.record.exifData.yCbCrCoefficients || '-' },
    ] as ExifItem[]
  }

  // å›¾åƒè°ƒæ•´
  private getAdjustmentParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'å¯¹æ¯”åº¦', value: this.record.exifData.contrast || '-' },
      { label: 'é¥±å’Œåº¦', value: this.record.exifData.saturation || '-' },
      { label: 'é”åº¦', value: this.record.exifData.sharpness || '-' },
      { label: 'äº®åº¦å€¼', value: this.record.exifData.brightness || '-' },
      { label: 'å¢ç›Šæ§åˆ¶', value: this.record.exifData.gainControl || '-' },
      { label: 'è‡ªå®šä¹‰æ¸²æŸ“', value: this.record.exifData.customRendered || '-' },
    ] as ExifItem[]
  }

  // æ‹æ‘„æ¨¡å¼
  private getSceneParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'åœºæ™¯æ•è·ç±»å‹', value: this.record.exifData.sceneCaptureType || '-' },
      { label: 'åœºæ™¯ç±»å‹', value: this.record.exifData.sceneType || '-' },
      { label: 'æ•°å­—å˜ç„¦æ¯”', value: this.record.exifData.digitalZoomRatio || '-' },
      { label: 'å…‰è°±çµæ•åº¦', value: this.record.exifData.spectalSensitivity || '-' },
    ] as ExifItem[]
  }

  // === P2 æŠ€æœ¯å‚æ•° ===
  // åˆ†è¾¨ç‡å‚æ•°
  private getResolutionParams(): ExifItem[] {
    if (!this.record) return []
    const xRes = this.record.exifData.xResolution
    const yRes = this.record.exifData.yResolution
    const unit = this.record.exifData.resolutionUnit
    const resStr = (xRes && yRes && unit) ? `${xRes} Ã— ${yRes} ${unit}` : '-'
    
    const fpXRes = this.record.exifData.focalPlaneXResolution
    const fpYRes = this.record.exifData.focalPlaneYResolution
    const fpUnit = this.record.exifData.focalPlaneResolutionUnit
    
    return [
      { label: 'å›¾åƒåˆ†è¾¨ç‡', value: resStr },
      { label: 'ç„¦å¹³é¢Xåˆ†è¾¨ç‡', value: fpXRes !== undefined && fpXRes > 0 ? fpXRes.toString() : '-' },
      { label: 'ç„¦å¹³é¢Yåˆ†è¾¨ç‡', value: fpYRes !== undefined && fpYRes > 0 ? fpYRes.toString() : '-' },
      { label: 'ç„¦å¹³é¢åˆ†è¾¨ç‡å•ä½', value: fpUnit || '-' },
    ] as ExifItem[]
  }

  // æ–‡ä»¶å…ƒæ•°æ®
  private getMetadataParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'å›¾ç‰‡æè¿°', value: this.record.exifData.imageDescription || '-' },
      { label: 'ä½œè€…', value: this.record.exifData.artist || '-' },
      { label: 'ç‰ˆæƒ', value: this.record.exifData.copyright || '-' },
      { label: 'ç”¨æˆ·è¯„è®º', value: this.record.exifData.userComment || '-' },
      { label: 'åˆ¶é€ å•†æ³¨é‡Š', value: this.record.exifData.makerNote || '-' },
      { label: 'ç›¸å…³éŸ³é¢‘æ–‡ä»¶', value: this.record.exifData.relatedSoundFile || '-' },
      { label: 'è®¾å¤‡è®¾ç½®æè¿°', value: this.record.exifData.deviceSettingDescription || '-' },
    ] as ExifItem[]
  }

  // æŠ€æœ¯å‚æ•°
  private getTechnicalParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'å‹ç¼©æ–¹å¼', value: this.record.exifData.compression || '-' },
      { label: 'å…‰åº¦è§£é‡Š', value: this.record.exifData.photometricInterpretation || '-' },
      { label: 'ä¼ è¾“å‡½æ•°', value: this.record.exifData.transferFunction || '-' },
      { label: 'å‚è€ƒé»‘ç™½å€¼', value: this.record.exifData.referenceBlackWhite || '-' },
      { label: 'å…‰ç”µè½¬æ¢å‡½æ•°', value: this.record.exifData.oecf || '-' },
      { label: 'æ–‡ä»¶æº', value: this.record.exifData.fileSource || '-' },
      { label: 'CFAå›¾æ¡ˆ', value: this.record.exifData.cFAPattern || '-' },
      { label: 'FlashPixç‰ˆæœ¬', value: this.record.exifData.flashpixVersion || '-' },
      { label: 'ISOé€Ÿç‡', value: this.record.exifData.isoSpeedRatings || '-' },
      { label: 'YCbCrå®šä½', value: this.record.exifData.yCbCrPositioning || '-' },
      { label: 'å›¾ç‰‡é•¿åº¦', value: this.record.exifData.imageLength?.toString() || '-' },
      { label: 'ç¼©ç•¥å›¾å®½åº¦', value: this.record.exifData.thumbnailImageWidth?.toString() || '-' },
      { label: 'ç¼©ç•¥å›¾é«˜åº¦', value: this.record.exifData.thumbnailImageHeight?.toString() || '-' },
    ] as ExifItem[]
  }

  // === P0 DNGä¸“æœ‰å‚æ•°ï¼ˆPhase 2æ–°å¢ï¼‰===
  private getDngParams(): ExifItem[] {
    if (!this.record) return []
    return [
      { label: 'DNGç‰ˆæœ¬', value: this.record.exifData.dngVersion || '-' },
      { label: 'DNGå‘åå…¼å®¹ç‰ˆæœ¬', value: this.record.exifData.dngBackwardVersion || '-' },
      { label: 'å”¯ä¸€ç›¸æœºå‹å·', value: this.record.exifData.uniqueCameraModel || '-' },
      { label: 'ç›¸æœºåºåˆ—å·(DNG)', value: this.record.exifData.cameraSerialNumberDNG || '-' },
      { label: 'DNGé•œå¤´ä¿¡æ¯', value: this.record.exifData.dngLensInfo || '-' },
      { label: 'åŸå§‹RAWæ–‡ä»¶å', value: this.record.exifData.originalRawFilename || '-' },
      { label: 'åŸºå‡†æ›å…‰', value: this.record.exifData.baselineExposure ? `${this.record.exifData.baselineExposure.toFixed(2)} EV` : '-' },
      { label: 'åŸºå‡†å™ªç‚¹', value: this.record.exifData.baselineNoise ? this.record.exifData.baselineNoise.toFixed(2) : '-' },
      { label: 'åŸºå‡†é”åº¦', value: this.record.exifData.baselineSharpness ? this.record.exifData.baselineSharpness.toFixed(2) : '-' },
      { label: 'çº¿æ€§å“åº”é™åˆ¶', value: this.record.exifData.linearResponseLimit ? this.record.exifData.linearResponseLimit.toFixed(2) : '-' },
      { label: 'é˜´å½±ç¼©æ”¾', value: this.record.exifData.shadowScale ? this.record.exifData.shadowScale.toFixed(2) : '-' },
      { label: 'é¢„è§ˆè‰²å½©ç©ºé—´', value: this.record.exifData.previewColorSpace || '-' },
    ] as ExifItem[]
  }

  @Builder
  ExifSection(title: string, items: ExifItem[]) {
    Column() {
      // æ ‡é¢˜ï¼ˆå¸¦å­—æ®µæ•°ç»Ÿè®¡ + å±•å¼€/æŠ˜å å›¾æ ‡ï¼‰
      Row() {
        // å±•å¼€/æŠ˜å å›¾æ ‡
        Text(this.expandedGroups.has(title) ? 'â–¼' : 'â–¶')
          .fontSize(12)
          .fontColor('#999999')
          .margin({ right: 8 })
        
        Text(title)
          .fontSize(15)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
        
        Blank()
        
        Text(`${this.getSectionFieldCount(items).nonEmpty}/${this.getSectionFieldCount(items).total}`)
          .fontSize(13)
          .fontColor('#999999')
      }
      .width('100%')
      .margin({ bottom: this.expandedGroups.has(title) ? 12 : 0 })
      .onClick(() => {
        this.toggleGroup(title)
      })
      
      // å­—æ®µåˆ—è¡¨ï¼ˆæ¡ä»¶æ¸²æŸ“ - åªæ¸²æŸ“å·²å±•å¼€çš„åˆ†ç»„ï¼‰
      if (this.expandedGroups.has(title)) {
        Column() {
          ForEach(items, (item: ExifItem, index: number) => {
          Row() {
            Text(item.label)
              .fontSize(13)
              .fontColor('#666666')
              .width(120)
            
            Text(item.value)
              .fontSize(13)
              .fontColor(item.value === '-' ? '#CCCCCC' : '#333333')
              .fontWeight(item.value === '-' ? FontWeight.Normal : FontWeight.Medium)
              .layoutWeight(1)
              .textAlign(TextAlign.End)
          }
          .width('100%')
          .height(36)
          .padding({ left: 12, right: 12 })
          .backgroundColor(index % 2 === 0 ? '#FAFAFA' : Color.White)
        })
      }
      .width('100%')
      .borderRadius(8)
      .clip(true)
    }  // ifæ¡ä»¶æ¸²æŸ“ç»“æŸ
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .margin({ top: 12 })
    .alignItems(HorizontalAlign.Start)
  }
}

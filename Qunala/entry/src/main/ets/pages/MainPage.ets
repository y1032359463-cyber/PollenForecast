/**
 * å»å“ªæ‹‰ - ä¸»é¡µé¢
 * åŒ…å«4ä¸ªTabï¼šåœ°å›¾ã€åˆ—è¡¨ã€è®°å½•ã€æˆ‘çš„
 */
import { Colors } from '../constants/Colors';
import { MapTab } from '../components/MapTab';
import { ListTab } from '../components/ListTab';
import { RecordTab } from '../components/RecordTab';
import { ProfileTab } from '../components/ProfileTab';

@Entry
@Component
struct MainPage {
  @State currentTabIndex: number = 0;
  
  // Tabæ ‡ç­¾æ•°æ®
  private tabData: TabItem[] = [
    { index: 0, icon: 'ğŸ—ºï¸', label: 'åœ°å›¾' },
    { index: 1, icon: 'ğŸ“‹', label: 'åˆ—è¡¨' },
    { index: 2, icon: 'ğŸ“', label: 'è®°å½•' },
    { index: 3, icon: 'ğŸ‘¤', label: 'æˆ‘çš„' }
  ];
  
  build() {
    Column() {
      // Tabå†…å®¹åŒºåŸŸ
      Tabs({
        barPosition: BarPosition.End,
        index: this.currentTabIndex
      }) {
        // Tab 1: åœ°å›¾
        TabContent() {
          this.MapTabContent()
        }
        .tabBar(this.TabBarBuilder(this.tabData[0]))
        
        // Tab 2: åˆ—è¡¨
        TabContent() {
          this.ListTabContent()
        }
        .tabBar(this.TabBarBuilder(this.tabData[1]))
        
        // Tab 3: è®°å½•
        TabContent() {
          this.RecordTabContent()
        }
        .tabBar(this.TabBarBuilder(this.tabData[2]))
        
        // Tab 4: æˆ‘çš„
        TabContent() {
          this.ProfileTabContent()
        }
        .tabBar(this.TabBarBuilder(this.tabData[3]))
      }
      .barMode(BarMode.Fixed)
      .barHeight(56)
      .barBackgroundColor(Colors.BG_PRIMARY)
      .onChange((index: number) => {
        this.currentTabIndex = index;
      })
      .width('100%')
      .height('100%')
    }
    .width('100%')
    .height('100%')
    .backgroundColor(Colors.BG_PRIMARY)
  }
  
  /**
   * è‡ªå®šä¹‰ TabBarï¼ˆå¸¦åŠ¨ç”»æ•ˆæœï¼‰
   */
  @Builder
  TabBarBuilder(item: TabItem) {
    Column() {
      // å›¾æ ‡
      Text(item.icon)
        .fontSize(24)
        .fontColor(this.currentTabIndex === item.index ? Colors.PRIMARY : Colors.TEXT_HINT)
      
      // æ–‡å­—
      Text(item.label)
        .fontSize(12)
        .fontColor(this.currentTabIndex === item.index ? Colors.PRIMARY : Colors.TEXT_HINT)
        .fontWeight(this.currentTabIndex === item.index ? FontWeight.Bold : FontWeight.Normal)
        .margin({ top: 4 })
      
      // ä¸‹åˆ’çº¿æŒ‡ç¤ºå™¨
      if (this.currentTabIndex === item.index) {
        Divider()
          .width(20)
          .height(3)
          .color(Colors.PRIMARY)
          .borderRadius(1.5)
          .margin({ top: 4 })
      }
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }
  
  /**
   * åœ°å›¾ Tab å†…å®¹
   */
  @Builder
  MapTabContent() {
    MapTab()
  }
  
  /**
   * åˆ—è¡¨ Tab å†…å®¹
   */
  @Builder
  ListTabContent() {
    ListTab()
  }
  
  /**
   * è®°å½• Tab å†…å®¹
   */
  @Builder
  RecordTabContent() {
    RecordTab()
  }
  
  /**
   * æˆ‘çš„ Tab å†…å®¹
   */
  @Builder
  ProfileTabContent() {
    ProfileTab()
  }
}

/**
 * Tabé¡¹æ•°æ®ç»“æ„
 */
interface TabItem {
  index: number;
  icon: string;
  label: string;
}

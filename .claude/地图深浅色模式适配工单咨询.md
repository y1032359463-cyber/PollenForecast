# åœ°å›¾æ·±æµ…è‰²æ¨¡å¼é€‚é…å·¥å•å’¨è¯¢

> **åˆ›å»ºæ—¶é—´**: 2026-01-08  
> **ç”¨é€”**: æäº¤åä¸ºå¼€å‘è€…å·¥å•å’¨è¯¢ Map Kit æ·±æµ…è‰²æ¨¡å¼é€‚é…æ–¹æ¡ˆ

---

## ğŸ“‹ é¡¹ç›®åŸºæœ¬ä¿¡æ¯

| é¡¹ç›®ä¿¡æ¯ | å€¼ |
|---------|-----|
| **åº”ç”¨åŒ…å** | `com.eric.PollenForecast` |
| **åº”ç”¨åç§°** | èŠ±ç²‰æµ“åº¦æ’­æŠ¥ |
| **SDKç‰ˆæœ¬** | HarmonyOS SDK 6.0.0 (API 20) |
| **åº”ç”¨ç‰ˆæœ¬** | 1.0.2 (versionCode: 1000004) |
| **å¼€å‘å·¥å…·** | DevEco Studio 6.0.x |
| **å¼€å‘è¯­è¨€** | ArkTS |
| **åº”ç”¨æ¨¡å‹** | Stageæ¨¡å‹ |

---

## ğŸ—ºï¸ åœ°å›¾é…ç½®ä¿¡æ¯

### Map Kit API Key

**é…ç½®æ–¹å¼**: é€šè¿‡ `module.json5` çš„ `metadata` é…ç½®

```json5
// entry/src/main/module.json5
"metadata": [
  {
    "name": "client_id",
    "value": "1783644396122594176"
  }
]
```

**API Key**: `1783644396122594176`

### åœ°å›¾åˆå§‹åŒ–ä»£ç 

**ä½ç½®**: `entry/src/main/ets/views/MapView.ets`

**åˆå§‹åŒ–æ–¹å¼**: ä½¿ç”¨ `MapComponent` ç»„ä»¶

```typescript
// åœ°å›¾é…ç½®
this.mapOptions = {
  position: {
    target: {
      latitude: this.latitude,
      longitude: this.longitude
    },
    zoom: 11
  },
  padding: {
    top: 208,
    bottom: 0,
    left: 0,
    right: 0
  },
  mapType: mapCommon.MapType.STANDARD,
  // è‡ªå®šä¹‰æ ·å¼è·¯å¾„ï¼ˆæ·±è‰²æ¨¡å¼é€‚é…ï¼‰- å½“å‰å·²æ³¨é‡Š
  // stylePath: this.currentColorMode === ConfigurationConstant.ColorMode.COLOR_MODE_DARK
  //   ? 'common/map_dark.json'
  //   : 'common/map_light.json',
  minZoom: 9,
  maxZoom: 14
}

// åœ°å›¾ç»„ä»¶
MapComponent({
  mapOptions: this.mapOptions,
  mapCallback: this.callback
})
```

**å¯¼å…¥çš„ Kit**:
```typescript
import { MapComponent, map, mapCommon } from '@kit.MapKit';
```

---

## ğŸŒ“ æ·±æµ…è‰²æ¨¡å¼å®ç°æƒ…å†µ

### åº”ç”¨ä¸»é¢˜åˆ‡æ¢æœºåˆ¶

**å®ç°ä½ç½®**: `entry/src/main/ets/entryability/EntryAbility.ets`

**ä¸»é¢˜ç›‘å¬**:
```typescript
onConfigurationUpdate(newConfig: Configuration): void {
  const newColorMode = newConfig.colorMode ?? ConfigurationConstant.ColorMode.COLOR_MODE_NOT_SET;
  AppStorage.setOrCreate('currentColorMode', newColorMode);
  // æ›´æ–°çŠ¶æ€æ æ ·å¼
  this.updateStatusBarForTheme(this.mainWindowInstance, newColorMode);
}
```

**çŠ¶æ€æ é€‚é…**:
- âœ… æµ…è‰²æ¨¡å¼ï¼šé€æ˜èƒŒæ™¯ + æ·±è‰²å›¾æ ‡ (`#000000`)
- âœ… æ·±è‰²æ¨¡å¼ï¼šé€æ˜èƒŒæ™¯ + ç™½è‰²å›¾æ ‡ (`#FFFFFF`)
- âœ… ä¸»é¢˜åˆ‡æ¢æ—¶çŠ¶æ€æ ç«‹å³æ›´æ–°

### åœ°å›¾ä¸»é¢˜åˆ‡æ¢å°è¯•

**ä½ç½®**: `entry/src/main/ets/views/MapView.ets` (Line 309-327)

**å½“å‰ä»£ç **ï¼ˆå·²æ³¨é‡Šï¼‰:
```typescript
// ç›‘å¬ä¸»é¢˜å˜åŒ–ï¼ˆä½¿ç”¨è‡ªå®šä¹‰æ ·å¼æ–‡ä»¶å®ç°æ·±è‰²æ¨¡å¼ï¼‰
onThemeChanged(): void {
  console.info(`[MapView] ä¸»é¢˜å˜åŒ–: ${this.currentColorMode}`)
  if (this.mapReady && this.mapController) {
    try {
      // ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼æ–‡ä»¶åˆ‡æ¢ä¸»é¢˜ï¼ˆéœ€è¦å…ˆåˆ›å»ºæ ·å¼æ–‡ä»¶ï¼‰
      // const stylePath = this.currentColorMode === ConfigurationConstant.ColorMode.COLOR_MODE_DARK
      //   ? 'common/map_dark.json'
      //   : 'common/map_light.json'
      // this.mapController.setMapStylePath(stylePath)
      // console.info(`[MapView] åœ°å›¾æ ·å¼å·²åˆ‡æ¢ä¸º: ${stylePath}`)
      
      // TODO: åˆ›å»ºè‡ªå®šä¹‰æ ·å¼æ–‡ä»¶åå¯ç”¨ä¸Šè¿°ä»£ç 
      console.info('[MapView] åœ°å›¾æ·±è‰²æ¨¡å¼æš‚æœªå¯ç”¨ï¼ˆéœ€è¦è‡ªå®šä¹‰æ ·å¼æ–‡ä»¶ï¼‰')
    } catch (err) {
      console.error(`[MapView] åˆ‡æ¢åœ°å›¾æ ·å¼å¤±è´¥: ${JSON.stringify(err)}`)
    }
  }
}
```

**ç›‘å¬æœºåˆ¶**:
```typescript
@StorageLink('currentColorMode') @Watch('onThemeChanged') 
currentColorMode: ConfigurationConstant.ColorMode = ConfigurationConstant.ColorMode.COLOR_MODE_NOT_SET
```

---

## â“ é‡åˆ°çš„é—®é¢˜

### é—®é¢˜æè¿°

1. **åœ°å›¾æ— æ³•å“åº”ç³»ç»Ÿæ·±æµ…è‰²æ¨¡å¼åˆ‡æ¢**
   - åº”ç”¨å…¶ä»–UIç»„ä»¶å·²æ­£ç¡®é€‚é…æ·±æµ…è‰²æ¨¡å¼
   - çŠ¶æ€æ ã€å¯¼èˆªæ ã€é¡µé¢èƒŒæ™¯éƒ½èƒ½æ­£ç¡®åˆ‡æ¢
   - ä½†åœ°å›¾å§‹ç»ˆæ˜¾ç¤ºä¸ºæµ…è‰²æ ·å¼ï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢

2. **å°è¯•ä½¿ç”¨ `setMapStylePath()` æ–¹æ³•**
   - ä»£ç ä¸­å·²é¢„ç•™ä¸»é¢˜åˆ‡æ¢é€»è¾‘
   - ä½†ä¸ç¡®å®šï¼š
     - æ˜¯å¦éœ€è¦åˆ›å»ºè‡ªå®šä¹‰æ ·å¼æ–‡ä»¶ï¼Ÿ
     - æ ·å¼æ–‡ä»¶æ ¼å¼å’Œè·¯å¾„è¦æ±‚ï¼Ÿ
     - æ˜¯å¦æœ‰ç³»ç»Ÿå†…ç½®çš„æ·±è‰²æ¨¡å¼æ ·å¼ï¼Ÿ

3. **MapOptions ä¸­çš„ stylePath é…ç½®**
   - åœ¨åˆå§‹åŒ– `MapOptions` æ—¶è®¾ç½® `stylePath` æ˜¯å¦æœ‰æ•ˆï¼Ÿ
   - è¿˜æ˜¯å¿…é¡»åœ¨è¿è¡Œæ—¶é€šè¿‡ `setMapStylePath()` åŠ¨æ€åˆ‡æ¢ï¼Ÿ

---

## ğŸ” ç›¸å…³ä»£ç ä½ç½®

### 1. åœ°å›¾ç»„ä»¶æ–‡ä»¶
- **æ–‡ä»¶**: `entry/src/main/ets/views/MapView.ets`
- **è¡Œæ•°**: çº¦ 920 è¡Œ
- **å…³é”®æ–¹æ³•**:
  - `onThemeChanged()` (Line 309-327) - ä¸»é¢˜åˆ‡æ¢ç›‘å¬
  - `aboutToAppear()` (Line 95-141) - åœ°å›¾åˆå§‹åŒ–
  - `callback()` (Line 330-401) - åœ°å›¾åˆå§‹åŒ–å›è°ƒ

### 2. ä¸»é¢˜é…ç½®
- **æ–‡ä»¶**: `entry/src/main/ets/entryability/EntryAbility.ets`
- **å…³é”®æ–¹æ³•**:
  - `onConfigurationUpdate()` (Line 199-210) - é…ç½®å˜åŒ–ç›‘å¬
  - `updateStatusBarForTheme()` (Line 134-164) - çŠ¶æ€æ ä¸»é¢˜æ›´æ–°

### 3. èµ„æºæ–‡ä»¶
- **é¢œè‰²èµ„æº**: 
  - `entry/src/main/resources/base/element/color.json` (æµ…è‰²æ¨¡å¼)
  - `entry/src/main/resources/dark/element/color.json` (æ·±è‰²æ¨¡å¼)
- **åœ°å›¾æ ·å¼æ–‡ä»¶**: âŒ å½“å‰ä¸å­˜åœ¨ï¼ˆéœ€è¦ç¡®è®¤æ˜¯å¦éœ€è¦åˆ›å»ºï¼‰

---

## ğŸ“ å’¨è¯¢é—®é¢˜

### é—®é¢˜1: Map Kit æ˜¯å¦æ”¯æŒç³»ç»Ÿæ·±æµ…è‰²æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ

- æ˜¯å¦æœ‰å†…ç½®çš„æ·±è‰²æ¨¡å¼æ ·å¼ï¼Ÿ
- æ˜¯å¦éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å®ç°ï¼Ÿ

### é—®é¢˜2: å¦‚ä½•å®ç°åœ°å›¾æ·±æµ…è‰²æ¨¡å¼åˆ‡æ¢ï¼Ÿ

**æ–¹æ¡ˆA**: ä½¿ç”¨ `setMapStylePath()` æ–¹æ³•
- æ˜¯å¦éœ€è¦åˆ›å»ºè‡ªå®šä¹‰æ ·å¼æ–‡ä»¶ï¼Ÿ
- æ ·å¼æ–‡ä»¶æ ¼å¼è¦æ±‚ï¼ˆJSONæ ¼å¼ï¼Ÿï¼‰ï¼Ÿ
- æ–‡ä»¶è·¯å¾„è§„åˆ™ï¼ˆ`common/map_dark.json` æ˜¯å¦æ­£ç¡®ï¼Ÿï¼‰ï¼Ÿ

**æ–¹æ¡ˆB**: åœ¨ `MapOptions` ä¸­é…ç½® `stylePath`
- åˆå§‹åŒ–æ—¶è®¾ç½® `stylePath` æ˜¯å¦æœ‰æ•ˆï¼Ÿ
- èƒ½å¦åŠ¨æ€åˆ‡æ¢æ ·å¼ï¼Ÿ

**æ–¹æ¡ˆC**: å…¶ä»–æ–¹æ¡ˆ
- æ˜¯å¦æœ‰æ›´ç®€å•çš„APIå®ç°è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ

### é—®é¢˜3: æ ·å¼æ–‡ä»¶æ ¼å¼å’Œç¤ºä¾‹

å¦‚æœå¿…é¡»ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼æ–‡ä»¶ï¼š
- æ ·å¼æ–‡ä»¶çš„æ ‡å‡†æ ¼å¼æ˜¯ä»€ä¹ˆï¼Ÿ
- æ˜¯å¦æœ‰å®˜æ–¹ç¤ºä¾‹æˆ–æ–‡æ¡£ï¼Ÿ
- æ·±è‰²æ¨¡å¼æ ·å¼éœ€è¦é…ç½®å“ªäº›å±æ€§ï¼Ÿ

### é—®é¢˜4: API å…¼å®¹æ€§

- `setMapStylePath()` æ–¹æ³•åœ¨ API 20 æ˜¯å¦å¯ç”¨ï¼Ÿ
- æ˜¯å¦æ”¯æŒ API 17+ è®¾å¤‡ï¼Ÿ

---

## ğŸ¯ æœŸæœ›çš„è§£å†³æ–¹æ¡ˆ

1. **æ¨èæ–¹æ¡ˆ**: å¸Œæœ›ä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼å®ç°åœ°å›¾æ·±æµ…è‰²æ¨¡å¼åˆ‡æ¢
2. **æ€§èƒ½è¦æ±‚**: åˆ‡æ¢æ—¶ä¸åº”æœ‰æ˜æ˜¾å»¶è¿Ÿæˆ–é—ªçƒ
3. **å…¼å®¹æ€§**: éœ€è¦æ”¯æŒ API 17+ è®¾å¤‡

---

## ğŸ“ é™„ä»¶ä¿¡æ¯

### å…³é”®ä»£ç ç‰‡æ®µ

**åœ°å›¾åˆå§‹åŒ–**:
```typescript
// MapView.ets - aboutToAppear()
this.mapOptions = {
  position: {
    target: { latitude: this.latitude, longitude: this.longitude },
    zoom: 11
  },
  mapType: mapCommon.MapType.STANDARD,
  minZoom: 9,
  maxZoom: 14
}
```

**ä¸»é¢˜ç›‘å¬**:
```typescript
// MapView.ets - onThemeChanged()
@StorageLink('currentColorMode') @Watch('onThemeChanged') 
currentColorMode: ConfigurationConstant.ColorMode

onThemeChanged(): void {
  if (this.mapReady && this.mapController) {
    // éœ€è¦ç¡®è®¤å¦‚ä½•åˆ‡æ¢åœ°å›¾æ ·å¼
  }
}
```

**åœ°å›¾æ§åˆ¶å™¨è·å–**:
```typescript
// MapView.ets - callback()
callback = (err: Error, controller: map.MapComponentController) => {
  this.mapController = controller
  this.mapReady = true
  // åœ°å›¾åˆå§‹åŒ–å®Œæˆ
}
```

---

## ğŸ“ è”ç³»æ–¹å¼

- **å¼€å‘è€…**: Eric Studio
- **åº”ç”¨åŒ…å**: com.eric.PollenForecast
- **é—®é¢˜ç±»å‹**: Map Kit API ä½¿ç”¨å’¨è¯¢

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- HarmonyOS Map Kit å®˜æ–¹æ–‡æ¡£: https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-map
- API 20 å‚è€ƒ: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-map

---

**å¤‡æ³¨**: æœ¬å·¥å•å’¨è¯¢æ–‡æ¡£å·²æ•´ç†å®Œæˆï¼Œå¯ç›´æ¥å¤åˆ¶åˆ°åä¸ºå¼€å‘è€…å·¥å•ç³»ç»Ÿæäº¤ã€‚


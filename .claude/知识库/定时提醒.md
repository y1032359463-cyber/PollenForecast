# å®šæ—¶æé†’ä¸åå°ä»»åŠ¡

> **åˆ†ç±»**: ä»£ç†æé†’ï¼ˆReminderAgentï¼‰ã€åå°ä»»åŠ¡ï¼ˆAPI 20ï¼‰  
> **æœ€åæ›´æ–°**: 2026-01-08  
> **è¿”å›**: [â† ä¸»çŸ¥è¯†åº“](../çŸ¥è¯†åº“.md)

---

## ğŸ“‘ æœ¬åˆ†ç±»åŒ…å«

1. [ä»£ç†æé†’ï¼ˆReminderAgentï¼‰å®ç°æ–¹æ¡ˆ](#ä»£ç†æé†’reminderagentå®ç°æ–¹æ¡ˆ)
2. [æƒé™ç”³è¯·ä¸é…ç½®](#æƒé™ç”³è¯·ä¸é…ç½®)
3. [å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ)

---

## ä»£ç†æé†’ï¼ˆReminderAgentï¼‰å®ç°æ–¹æ¡ˆ

> âœ… **å·²éªŒè¯**: 2026-01-07 (PollenForecast é¡¹ç›®)  
> **æ¥æº**: åä¸ºå®˜æ–¹æ–‡æ¡£ + çœŸæœºæ„å»ºéªŒè¯  
> **é€‚ç”¨é¡¹ç›®**: éœ€è¦åå°å®šæ—¶å‘é€é€šçŸ¥çš„åº”ç”¨

### æ ¸å¿ƒçŸ¥è¯†ç‚¹

#### 1. æ­£ç¡®çš„å¯¼å…¥æ–¹å¼ï¼ˆææ˜“è¸©å‘ï¼ï¼‰

```typescript
// âœ… æ­£ç¡®å¯¼å…¥ - ä» BackgroundTasksKit
import { reminderAgentManager } from '@kit.BackgroundTasksKit';

// âŒ é”™è¯¯å¯¼å…¥ - ä¸è¦ä» NotificationKitï¼ˆæ‰€æœ‰ä¸“å®¶éƒ½ç»™é”™äº†ï¼‰
import { reminderAgentManager } from '@kit.NotificationKit';  // ç¼–è¯‘å¤±è´¥ï¼
```

**è¸©å‘ç»å†**ï¼š
- åä¸ºæ™ºèƒ½åŠ©æ‰‹ã€å°ç±³MIMOã€CodeGenie ä¸‰ä½ä¸“å®¶éƒ½ç»™äº†é”™è¯¯çš„å¯¼å…¥æ–¹å¼
- æ­£ç¡®æ–¹å¼æ¥è‡ªåä¸ºå®˜æ–¹æ–‡æ¡£ï¼šhttps://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-reminderagentmanager

#### 2. å®Œæ•´å®ç°ä»£ç ï¼ˆå«é€šçŸ¥é…ç½®ï¼‰

```typescript
// ReminderService.ets
import { reminderAgentManager } from '@kit.BackgroundTasksKit';
import { BusinessError } from '@kit.BasicServicesKit';
import { notificationManager } from '@kit.NotificationKit';

export class ReminderService {
  private reminderId: number = -1;

  async scheduleDailyReminder(hour: number, minute: number): Promise<boolean> {
    try {
      // å…ˆå–æ¶ˆæ‰€æœ‰æ—§æé†’ï¼ˆè§£å†³æ•°é‡è¶…é™é—®é¢˜ï¼‰
      await this.cancelAllReminders();

      // åˆ›å»ºé—¹é’Ÿæé†’ï¼ˆæ¯å¤©é‡å¤ï¼‰- å®Œæ•´é…ç½®
      const reminderRequest: reminderAgentManager.ReminderRequestAlarm = {
        reminderType: reminderAgentManager.ReminderType.REMINDER_TYPE_ALARM,
        hour: hour,
        minute: minute,
        daysOfWeek: [1, 2, 3, 4, 5, 6, 7],  // æ¯å¤©
        title: 'ğŸŒ¼ æ¯æ—¥æé†’',
        content: 'æ‚¨è®¾ç½®çš„å®šæ—¶æé†’åˆ°äº†',
        expiredContent: 'æé†’å·²è¿‡æœŸ',
        snoozeContent: 'ç¨åæé†’',
        notificationId: 1001,  // âœ… å›ºå®šé€šçŸ¥ID
        slotType: notificationManager.SlotType.SOCIAL_COMMUNICATION,  // âœ… å…³é”®ï¼æ¨ªå¹…+å£°éŸ³+éœ‡åŠ¨
        ringDuration: 10,
        snoozeTimes: 2,
        timeInterval: 5 * 60,  // ç¨åæé†’é—´éš”ï¼ˆç§’ï¼‰
        actionButton: [  // âœ… é€šçŸ¥æŒ‰é’®
          { title: 'ç¨åæé†’', type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_SNOOZE },
          { title: 'å…³é—­', type: reminderAgentManager.ActionButtonType.ACTION_BUTTON_TYPE_CLOSE }
        ],
        wantAgent: {  // âœ… ç‚¹å‡»é€šçŸ¥æ‰“å¼€åº”ç”¨
          pkgName: 'com.example.app',
          abilityName: 'EntryAbility'
        }
      };

      this.reminderId = await reminderAgentManager.publishReminder(reminderRequest);
      return true;
    } catch (err) {
      const error = err as BusinessError;
      console.error(`è®¾ç½®æé†’å¤±è´¥: ${error.code} - ${error.message}`);
      return false;
    }
  }

  // âš ï¸ cancelAllReminders() æ˜¯ç³»ç»ŸAPIï¼Œæ™®é€šåº”ç”¨æ”¹ç”¨é€ä¸ªå–æ¶ˆ
  async cancelAllReminders(): Promise<void> {
    const reminders = await reminderAgentManager.getValidReminders();
    for (let i = 0; i < reminders.length; i++) {
      const reminderStr = JSON.stringify(reminders[i]);
      const obj = JSON.parse(reminderStr) as { reminderId?: number };
      if (obj.reminderId !== undefined) {
        await reminderAgentManager.cancelReminder(obj.reminderId);
      }
    }
  }
}
```

#### 3. slotType å…³é”®é…ç½®è¯´æ˜

| slotType å€¼ | è¡¨ç°å½¢å¼ |
|------------|---------|
| `SOCIAL_COMMUNICATION` | âœ… **æ¨è** æ¨ªå¹…+å£°éŸ³+éœ‡åŠ¨ |
| `SERVICE_INFORMATION` | çŠ¶æ€æ +å£°éŸ³ |
| `CONTENT_INFORMATION` | ä»…çŠ¶æ€æ  |
| `OTHER` | é™é»˜é€šçŸ¥ |

**è¸©å‘**ï¼šä¸è®¾ç½® `slotType` ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œå¯¼è‡´åªæœ‰çŠ¶æ€æ é€šçŸ¥ï¼Œæ²¡æœ‰æ¨ªå¹…å¼¹çª—ï¼

#### 4. æé†’ç±»å‹

| ç±»å‹ | æšä¸¾å€¼ | è¯´æ˜ |
|------|-------|------|
| å®šæ—¶å™¨ | `REMINDER_TYPE_TIMER` | å€’è®¡æ—¶æé†’ |
| é—¹é’Ÿ | `REMINDER_TYPE_ALARM` | å›ºå®šæ—¶é—´æé†’ï¼ˆæ”¯æŒæ¯å¤©/æ¯å‘¨é‡å¤ï¼‰|
| æ—¥å† | `REMINDER_TYPE_CALENDAR` | æ—¥å†äº‹ä»¶æé†’ |

---

## æƒé™ç”³è¯·ä¸é…ç½®

### module.json5 é…ç½®

```json5
{
  "requestPermissions": [
    {
      "name": "ohos.permission.PUBLISH_AGENT_REMINDER",
      "reason": "$string:reminder_permission_reason",
      "usedScene": {
        "abilities": ["EntryAbility"],
        "when": "always"
      }
    }
  ]
}
```

### æƒé™çº§åˆ«è¯´æ˜

| æƒé™ | çº§åˆ« | å¯ç”¨æ€§ |
|------|------|--------|
| `PUBLISH_AGENT_REMINDER` | normal | âœ… ä¸ªäººå¼€å‘è€…å¯ç”³è¯· |

**é‡è¦è¯´æ˜**ï¼š
- ä¸ªäººå¼€å‘è€…å¯ä»¥ç”³è¯·æ­¤æƒé™
- éœ€è¦åœ¨ AppGallery Connect ä¸­ç”³è¯·å¼€é€šæƒç›Šï¼ˆé’ˆå¯¹æ‰‹æœºç­‰å—ç®¡æ§è®¾å¤‡ï¼‰
- ç”³è¯·é‚®ä»¶éœ€åŒ…å«ï¼šå¼€å‘è€…IDã€APP IDã€åº”ç”¨åç§°ã€åŠŸèƒ½è¯´æ˜ã€æ‰¿è¯ºä¸ç”¨äºå¹¿å‘Šè¥é”€

### åŠ¨æ€æƒé™ç”³è¯·

```typescript
// EntryAbility.ets
import { abilityAccessCtrl, Permissions } from '@kit.AbilityKit';

private async requestReminderPermission(): Promise<void> {
  const permissions: Array<Permissions> = [
    'ohos.permission.PUBLISH_AGENT_REMINDER'
  ];

  try {
    const atManager = abilityAccessCtrl.createAtManager();
    const grantStatus = await atManager.requestPermissionsFromUser(this.context, permissions);
    
    if (grantStatus.authResults[0] === 0) {
      console.info('âœ… ä»£ç†æé†’æƒé™å·²æˆäºˆ');
    } else {
      console.warn('âš ï¸ ä»£ç†æé†’æƒé™è¢«æ‹’ç»');
    }
  } catch (err) {
    console.error('âŒ è¯·æ±‚ä»£ç†æé†’æƒé™å¤±è´¥: ' + JSON.stringify(err));
  }
}
```

---

## å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `Module has no exported member 'reminderAgentManager'` | ä»é”™è¯¯çš„ Kit å¯¼å…¥ | æ”¹ä¸º `@kit.BackgroundTasksKit` |
| `This application is not system-app, can not use system-api` | è°ƒç”¨ç³»ç»ŸAPI `cancelAllReminders()` | æ”¹ç”¨ `getValidReminders()` + é€ä¸ªå–æ¶ˆ |
| `PUBLISH_AGENT_REMINDER permission denied` | æƒé™æœªå£°æ˜æˆ–æœªç”³è¯· | æ£€æŸ¥ module.json5 æƒé™é…ç½®ï¼ŒåŠ¨æ€ç”³è¯·æƒé™ |
| æé†’æ•°é‡è¶…é™ï¼ˆé”™è¯¯ç 1700002ï¼‰ | è¶…è¿‡30ä¸ªæœ‰æ•ˆæé†’ | å…ˆæ¸…ç†æ—§æé†’å†è®¾ç½®æ–°æé†’ |

### ä¸æ™®é€šé€šçŸ¥çš„åŒºåˆ«

| åŠŸèƒ½ | æ™®é€šé€šçŸ¥ (notificationManager) | ä»£ç†æé†’ (reminderAgentManager) |
|------|------------------------------|-------------------------------|
| å¯¼å…¥ Kit | `@kit.NotificationKit` | `@kit.BackgroundTasksKit` |
| åº”ç”¨å…³é—­å | âŒ æ— æ³•è§¦å‘ | âœ… ç³»ç»Ÿçº§è§¦å‘ |
| å®šæ—¶åŠŸèƒ½ | âŒ éœ€è‡ªå·±å®ç° | âœ… å†…ç½®æ”¯æŒ |
| é‡å¤æé†’ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒæ¯å¤©/æ¯å‘¨ |
| æƒé™ | ç”¨æˆ·æˆæƒå³å¯ | éœ€è¦ `PUBLISH_AGENT_REMINDER` |

---

## ğŸ”— ç›¸å…³èµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-reminderagentmanager
- **æƒé™ç”³è¯·**: é€šè¿‡ AppGallery Connect æˆ–å‘é€é‚®ä»¶è‡³åä¸ºå¼€å‘è€…æ”¯æŒé‚®ç®±


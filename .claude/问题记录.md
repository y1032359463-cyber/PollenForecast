# 问题记录与解决方案

> **最后更新**: 2026-01-08  
> **当前状态**: 定时提醒功能已修复（2026-01-07）

---

## 📋 当前问题

### 2026-01-11 敏舒API代理服务器故障 🔧

**问题描述**：
- 敏舒花粉API代理服务器 `http://106.12.143.105:3000` 返回404错误
- 所有请求端点（根URL和 `/minshu/pollen/day`）均不可用
- 前两天测试正常，现在突然失效

**影响范围**：
- AUTO模式下国内城市无法获取敏舒数据
- 手动选择敏舒数据源时功能不可用

**应急处理**：✅ 已完成
1. ✅ 增强 `PollenService.ets` AUTO模式降级策略
   - 原逻辑：敏舒失败 → 返回null → 无数据显示
   - 新逻辑：敏舒失败 → 自动降级到Google API → 保证数据可用
2. ✅ 恢复日期生成逻辑（移除测试用的固定日期）

**待办事项**：
- [ ] 部署新的敏舒API代理服务器作为冗余
- [ ] 实现服务器健康检查和自动切换
- [ ] 考虑多个代理服务器负载均衡

**技术要点**：
- 多数据源架构的重要性：单一依赖容易导致服务不可用
- 降级策略必须完善：失败后有备用方案
- 监控告警：需要定期检查服务器可用性

---

### API 17 设备安装失败问题（历史问题）

问题：API 17设备安装HAP时提示"code:9568297 error: install failed due to older sdk version in the device"

原因：build-profile.json5中targetSdkVersion和compatibleSdkVersion设置为6.0.0(20)，导致无法安装到API 17设备

修复：已修改build-profile.json5，将SDK版本降级到5.0.0(17)
- ✅ targetSdkVersion: "6.0.0(20)" → "5.0.0(17)"
- ✅ compatibleSdkVersion: "6.0.0(20)" → "5.0.0(17)"
- ✅ 用户确认已通过真机测试

---

## 📚 已解决问题归档

### 2026-01-07 定时提醒功能修复 ✅

**审核反馈**:
> 设置-通知设置-每日播报-播报时间-选择播报时间：开设备提示权限后应用内设置提示时间后到时间无响应

**解决方案**：
- ✅ 使用 `reminderAgentManager` 从 `@kit.BackgroundTasksKit` 导入
- ✅ 权限：`ohos.permission.PUBLISH_AGENT_REMINDER`（normal级别，个人开发者可申请）
- ✅ 实现 ReminderService，支持每日重复提醒
- ✅ 修复 cancelAllReminders 系统API问题（改用逐个取消）

**详细内容**：已迁移至 `知识库/定时提醒.md`

### 2026-01-08 错别字修复 ✅

**问题**：ReminderService.ets 中"稀后提醒"应为"稍后提醒"

**修复**：4处错别字已修正

### 2026-01-08 ArkTS 语法错误修复 ✅

**问题**：LocationService.ets 对象字面量类型错误

**修复**：
- 添加 `AddressInfo` 接口替代对象字面量类型
- 错误码: `arkts-no-obj-literals-as-types` / `arkts-no-untyped-obj-literals`

**详细内容**：已迁移至 `知识库/ArkTS语法.md`

### 2026-01-08 API 17 设备安装失败问题 🔄 待解决

**问题**：API 17设备安装HAP时提示"code:9568297 error: install failed due to older sdk version in the device"

**错误含义**：设备上的镜像版本低于编译打包的SDK版本

**正确解决方案**（非降级）：
1. **保持 targetSdkVersion 为 6.0.0(20)**（使用最新特性）
2. **设置 compatibleSdkVersion 为兼容的最低版本**（如 5.0.0(17)）
3. **更新设备镜像版本**（推荐方案）
   - 查询设备镜像版本：`hdc shell param get const.ohos.apiversion`
   - 如果镜像版本为10，且应用使用的SDK版本也为10，仍出现该报错，可能是由于镜像版本较低，未兼容新版本SDK校验规则，请将镜像版本更新为最新版本

**当前状态**：
- ✅ 代码层面已做API 17兼容性处理（ApiVersionUtils、MapView事件监听兼容）
- ⏳ 需要确认正确的 compatibleSdkVersion 格式
- ⏳ 或更新设备镜像版本到最新

---

## 📋 历史问题（已解决）

### 2025-12-29 API 版本兼容性问题 ✅ 已解决

**详细内容**：已迁移至 `知识库/API兼容性.md`

### 2025-12-24 AppGallery 审核反馈修复 ✅ 已解决

**详细内容**：已迁移至 `知识库/UI组件.md`

### 2025-12-07 构建修复记录 ✅ 已解决

**详细内容**：已迁移至知识库

---

**📌 提示**：已解决的问题详细内容已迁移到知识库，此处仅保留关键信息。

/*
 * Copyright (c) 2024 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import { ModernTaskCard } from './ModernTaskCard';
import TaskInfo from '../../viewmodel/TaskInfo';
import { AppConfig } from '../../common/config/AppConfig';

/**
 * ç°ä»£åŒ–ä»»åŠ¡å¡ç‰‡é€‚é…å™¨
 * 
 * å°†åŸæœ‰TaskCardæ¥å£é€‚é…åˆ°æ–°çš„ModernTaskCardç»„ä»¶
 * ä¿æŒä¸HomeComponentçš„å…¼å®¹æ€§
 */
@Component
export struct ModernTaskCardAdapter {
  @Prop taskInfoStr: string = '';
  clickAction: Function = (isClick: boolean) => {};
  @State taskInfo: TaskInfo = new TaskInfo(-1, '', -1, '', false, '', '', '', false, '', false);

  aboutToAppear() {
    this.taskInfo = JSON.parse(this.taskInfoStr);
  }

  // è·å–ä»»åŠ¡ç±»å‹çš„emojiå›¾æ ‡
  private getTaskEmoji(): string {
    const emojiMap: Record<number, string> = {
      1: 'ğŸ›ï¸',  // æ—©èµ·
      2: 'ğŸ’§',  // å–æ°´
      3: 'ğŸ',  // åƒè‹¹æœ
      4: 'ğŸ˜Š',  // å¾®ç¬‘
      5: 'ğŸª¥',  // åˆ·ç‰™
      6: 'ğŸŒ™'   // ç¡çœ 
    };
    return emojiMap[this.taskInfo.taskID] || 'ğŸ“';
  }

  // è·å–ä»»åŠ¡ç±»å‹çš„é¢œè‰²
  private getTaskColor(): string {
    // é»˜è®¤é¢œè‰²æ˜ å°„ (ä¸Figmaè®¾è®¡ä¸€è‡´)
    const defaultColors: Record<number, string> = {
      1: '#FF6B6B',  // æ—©èµ·
      2: '#4ECDC4',  // å–æ°´
      3: '#FF6B35',  // åƒè‹¹æœ
      4: '#FFD93D',  // å¾®ç¬‘
      5: '#95E1D3',  // åˆ·ç‰™
      6: '#6C5CE7'   // ç¡çœ 
    };
    return defaultColors[this.taskInfo.taskID] || '#00C853';
  }
  
  // è·å–ä»»åŠ¡åç§°
  private getTaskName(): string {
    const taskNames: Record<number, string> = {
      1: 'æ—©èµ·',
      2: 'å–æ°´',
      3: 'åƒè‹¹æœ',
      4: 'å¾®ç¬‘',
      5: 'åˆ·ç‰™',
      6: 'æ—©ç¡'
    };
    return taskNames[this.taskInfo.taskID] || 'ä»»åŠ¡';
  }

  // è·å–ä»»åŠ¡å•ä½
  private getTaskUnit(): string {
    try {
      const appConfig = AppConfig.getInstance();
      const taskType = appConfig.getTaskTypeById(this.taskInfo.taskID);
      if (taskType) {
        return taskType.unit;
      }
    } catch (error) {
      // é…ç½®æœªåŠ è½½,ä½¿ç”¨é»˜è®¤å•ä½
    }
    
    const defaultUnits: Record<number, string> = {
      1: 'æ¬¡',
      2: 'æ¯',
      3: 'ä¸ª',
      4: 'æ¬¡',
      5: 'æ¬¡',
      6: 'æ¬¡'
    };
    return defaultUnits[this.taskInfo.taskID] || 'æ¬¡';
  }

  build() {
    ModernTaskCard({
      icon: this.getTaskEmoji(),
      title: this.getTaskName(),
      current: parseInt(this.taskInfo.finValue) || 0,
      total: parseInt(this.taskInfo.targetValue) || 1,
      unit: this.getTaskUnit(),
      color: this.getTaskColor(),
      onCardClick: () => {
        this.clickAction(true);
      }
    })
  }
}
